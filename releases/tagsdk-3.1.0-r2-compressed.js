(function(){var E,B;function J(){function a(d){e.events.push(d);m(e.listeners,function(a){if(!a.disposed&&c(a.type,d.meta.type))try{a.callback.call(a.context,d)}catch(b){console&&console.error&&console.error("Error emitting UV event",b.stack)}});b.shift();0<b.length&&a(b[0])}function m(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)}function g(a){var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b}function c(a,b){return"string"===typeof a?a===b:a.test(b)}function d(a,b){for(var d=a.length,
c=[],e=0;e<d;e++)b(a[e])&&c.push(a[e]);return c}var b=[],e={emit:function(c,f){f=g(f||{});f.meta=f.meta||{};f.meta.type=c;b.push(f);1===b.length&&a(b[0]);e.listeners=d(e.listeners,function(a){return!a.disposed})},on:function(a,b,d){var g={type:a,callback:b,disposed:!1,context:d||window};e.listeners.push(g);var q={replay:function(){m(e.events,function(e){g.disposed||c(a,e.meta.type)&&b.call(d,e)});return q},dispose:function(){g.disposed=!0;return q}};return q},once:function(a,b,d){var c=e.on(a,function(){b.apply(d||
window,arguments);c.dispose()});return c},events:[],listeners:[]};return e}function L(){var a=G.uv;if(!a||!a.emit)return!1;if(!K){K=!0;for(var m=0;m<F.length;m++){var g=F[m];g.on?a.on.apply(a,g.on):g.emit&&a.emit.apply(a,g.emit)}a.on(/.*/,function(a){var d=a.meta.type,b=H[d];b?(b.current=a,b.history.push(a)):H[d]={current:a,history:[a]}}).replay();I=!0}return!0}(function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var m=Array.prototype.slice.call(arguments,1),g=this,c=function(){},d=function(){return g.apply(this instanceof c?this:a,m.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;d.prototype=new c;return d})})();var C={__anonymous__:!0},y=null;try{y=(0,eval)("this")||function(){return this}()}catch(M){}var C=y,h=C.qubit||{};C.qubit||(C.qubit=h);if(h.VERSION&&"3.1.0-r2"!==h.VERSION)try{console.warn("There is already 'qubit.VERSION' set to: "+h.VERSION)}catch(N){}h.VERSION="3.1.0-r2";
try{"object"===typeof module&&(module.exports=C)}catch(O){}var x=function(){};(function(){function a(){}function m(d,b,c,l,f){d=d.split(".");var n=a.NAMESPACE_BASE||C,g=null,q=null;f&&(n=y);f=n;n=c||n;for(c=0;c<d.length-1;c+=1)q=d[c],n[q]=n[q]||{},n=n[q];g=n;q=d[d.length-1];y.TAGSDK_NS_OVERRIDE&&(l=!1);void 0!==y.TAGSDK_NS_FORCED_OVERRIDE_OPTION&&(l=!y.TAGSDK_NS_FORCED_OVERRIDE_OPTION);void 0!==b?void 0!==g[q]&&l||(g[q]=b):g[q]=g[q]||{};b&&(b.CLASSPATH=d.join("."),d.splice(d.length-1,1),b.PACKAGE_NAME=
d.join("."));return{root:f,object:g,instance:g[q]}}a.global=function(){return y};a.STANDARD_CS_NS="qubit.cs";a.clientSpaceClasspath=function(){return window.qubit.CLIENT_CONFIG?"qubit.cs.d"+window.qubit.CLIENT_CONFIG.id:a.STANDARD_CS_NS};a.globalNamespace=function(a,b,c,l){return m(a,b,c,l,!0)};a.namespace=function(a,b,c,l){return m(a,b,c,l,!1)};a.clientNamespace=function(c,b,e,l){return a.namespace(a.clientSpaceClasspath()+"."+c,b,e,l)};a.clazz=function(c,b,e,l,f){a.namespace(c,b,l,!0);"function"===
typeof e&&(b.SUPER=e,b.superclass=e,b.prototype=new e(f),b.prototype.SUPER=e,b.prototype.CLASS=b);c=c.split(".");b.prototype?(b.prototype.CLASSPATH=c.join("."),b.prototype.CLASS_NAME=c[c.length-1],c.splice(c.length-1,1),b.prototype.PACKAGE_NAME=c.join(".")):(b.CLASSPATH=c.join("."),b.STATIC_NAME=c[c.length-1],c.splice(c.length-1,1),b.PACKAGE_NAME=c.join("."));return b};a.clazz("qubit.Define",a);a.clientClazz=function(c,b,e,l,f){return a.clazz(a.clientSpaceClasspath()+"."+c,b,e,l,f)};a.STANDARD_VS_NS=
"qubit.vs";a.vendorsSpaceClasspath=function(c){var b=h.VENDOR_SPACE_CP,b=void 0===b||null===b?a.STANDARD_VS_NS:b;return c?b?b+"."+c:c:b};var g=a.vendorsSpaceClasspath(),c;c=g?a.namespace(g,{},null,!0).instance:a.global();a.getVendorSpace=function(){return c};a.vendorNamespace=function(c,b,e,l){c=a.vendorsSpaceClasspath(c);return a.namespace(c,b,e,l)};a.vendorClazz=function(c,b,e,l,f){c=a.vendorsSpaceClasspath(c);return a.clazz(c,b,e,l,f)}})();(function(){function a(a){}for(var m={},g=0;93>g;g++)m["abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=".charAt(g)]=
g;h.Define.clazz("qubit.Cookie",a);a.cookieAlphabet="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=";a.cookieAlphabetMap=m;a.decode=function(a){return unescape(a)};a.encode=function(a){return escape(a)};a.set=function(c,d,b,e,l){if(b){var f=new Date;f.setTime(f.getTime()+864E5*b);b="; expires="+f.toGMTString()}else b="";l||(c=a.encode(c),d=a.encode(d));c=c+"="+d+b+"; path=/;";e&&(c+=" domain="+e);document.cookie=c};a.get=function(c,d){for(var b=c+"=",
e=document.cookie.split(";"),l=0;l<e.length;l++){for(var f=e[l];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return b=f.substring(b.length,f.length),d||(b=a.decode(b)),b}return null};a.getAllForName=function(c,d){if(!c)return[];for(var b=c+"=",e=document.cookie.split(";"),l=[],f=0;f<e.length;f++){for(var n=e[f];" "===n.charAt(0);)n=n.substring(1,n.length);0===n.indexOf(b)&&(n=n.substring(b.length,n.length),d&&(n=a.decode(n)),l.push(n))}return l};a.getAll=function(c){for(var d=
document.cookie.split(";"),b=[],e=0;e<d.length;e++){for(var l=d[e];" "===l.charAt(0);)l=l.substring(1,l.length);var f=l.substring(0,l.indexOf("=")),l=l.substring(f.length+1,l.length);c&&(l=a.decode(l));b.push([f,l])}return b};a.rm=function(c,d){a.set(c,"",-1,d)}})();(function(){function a(a,k){for(var b=l.length,c=0;c<b;c++)if(a===l[c][0])return l[c][1];l[l.length]=[a,k];return!1}function m(b,k,c,f,d){var n=!1,g=!1,q=!1,p=!1,r=!1,h=r=!1;k&&(n=(r=!!k.all)||k.nodes,p=r||k.win,g=r,h=!!k.emptyForMaxDeep,
q=k.noFunctions&&!r,void 0!==k.noOwn&&(g=!!k.noOwn),void 0!==k.noFunctions&&(q=!!k.noFunctions),void 0!==k.win&&(p=!!k.win),void 0!==k.nodes&&(n=!!k.nodes),r=!!k.copyReference);if(void 0===c||c)void 0!==c&&c--;else return h?void 0:b;if(!(b&&b instanceof Object))return b;if(!n){try{if(b instanceof Node)return b}catch(w){if(b instanceof ActiveXObject&&void 0!==b.nodeType)return b}if(b===document)return b}if(!p&&b===e)return b;n=b instanceof Array?[]:{};b instanceof Date&&(n=new Date(b));!q&&b instanceof
Function&&(q=String(b).replace(/\s+/g,""),n=q.indexOf("{[nativecode]}")+14===q.length?function(){return b.apply(d||this,arguments)}:function(){return b.apply(this,arguments)});void 0===f&&(l=[],f=0);if(q=a(b,n))return q;if(n instanceof Array)for(q=0;q<b.length;q++)n[n.length]=b[q]===b[q]?m(b[q],k,c,f+1,b):b[q];else{var q=0,s;for(s in b){if(g||b.hasOwnProperty(s))n[s]=b[s]===b[s]?m(b[s],k,c,f+1,b):b[s];q++}}k.proto&&(n.prototype=m(b.prototype,k,c,f+1,b));r&&(n.___copy_ref=b);return n}function g(a,
k,b,c,d,n,l,q){b=b||{};void 0===b.hasOwn&&(b.hasOwn=!0);if(!b.objectsOnly||a instanceof Object)if(void 0===q||q){void 0!==q&&q--;if(!b||!b.nodes)try{if(a instanceof Node)return}catch(m){if(a instanceof ActiveXObject&&void 0!==a.nodeType)return}if(a!==e){void 0===c&&(f=[],c=0);var p;a:{for(p=0;p<c&&p<f.length;p++)if(a===f[p]){p=!0;break a}p=!1}if(!(p||(f[c]=a,d=d||a,d&&n&&d[n]!==d[n]||k(a,d,n,l)))){n=0;p="";for(var r in a){if(!b.hasOwn||a.hasOwnProperty(r))try{var h=a[r];b.track&&(p=l?l+"."+r:r);g(h,
k,b,c+1,d,r,p,q)}catch(w){}n++}}}}}var c=h.Define,d=h.Cookie,b=function(){},e=c.global();c.clazz("qubit.opentag.Utils",b);b.global=c.global;b.namespace=c.namespace;b.clazz=c.clazz;b.getObjectUsingPath=function(a,k){k=k||e;for(var b=a.split("."),c=0;c<b.length;c++)k&&b[c]&&(k=k[b[c]]);return k};b.getParentObject=function(a){var k=a.lastIndexOf(".");a=a.substring(0,k);return b.getObjectUsingPath(a)};b.variableExists=function(a){return void 0!==a&&null!==a};b.ANON_VARS=[];b.getAnonymousAcessor=function(a){var k=
b.indexInArray(a,b.ANON_VARS);-1===k&&(k=b.addToArrayIfNotExist(b.ANON_VARS,a));return"qubit.opentag.Utils.ANON_VARS["+k+"]"};b.replaceAll=function(a,k,b){return a.replace(new RegExp(k.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),b)};b.secureText=function(a){"string"!==typeof a&&(a+="");a=a.replace(/</g,"&lt;");return a=a.replace(/>/g,"&gt;")};b.getUrl=function(){return document.location.href};b.getQueryParam=function(a){var k,c,f,d;k=b.getUrl();if(0<k.indexOf("?"))for(d=k.substring(k.indexOf("?")+
1).split("&"),k=0,c=d.length;k<c;k+=1)if(f=d[k],0<f.indexOf("=")&&(f=f.split("="),2===f.length&&f[0]===a))return f[1];return null};b.getElementValue=function(a){return(a=document.getElementById(a))?a.textContent||a.innerText:null};var l=[];b.objectCopy=function(a,k){k=k||{};var b=m(a,k,k.maxDeep);l=[];return b};var f=[];b.traverse=function(a,k,b){g(a,k,b,void 0,void 0,void 0,void 0,b.maxDeep)};b.prepareQuotedString=function(a){return"string"===typeof a?'"'+a.replace(/\"/g,'\\"')+'"':a};b.expressionToFunction=
function(a,k){return b.gevalAndReturn("function ("+(k||"")+") {"+a+"}").result};b.defineWrappedClass=function(a,k,b,f,d){var e=function(){return d?d.apply(this,arguments):k.apply(this,arguments)};c.clazz(a,e,k,f);for(var n in b)b.hasOwnProperty(n)&&"CONSTRUCTOR"!==n&&(e.prototype[n]=b[n]);return e};b.copyAandAddFromB=function(a,k,b){a=this.objectCopy(a,{maxDeep:b||8});for(var c in k)k.hasOwnProperty(c)&&(a[c]=k[c]);return a};b.keys=function(a){if(a instanceof Object){if(Object.keys)return Object.keys(a);
var k=[],b;for(b in a)a.hasOwnProperty(b)&&(k[k.length]=b);return k}throw"keys() called on non-object!";};b.getSrcElement=function(a){var k;a=a||window.event;a.srcElement?k=a.srcElement:a.target&&(k=a.target);return k};b.addToArrayIfNotExist=function(a,k,b){for(var c=0,f=!1;c<a.length;c+=1)if(b&&b(a[c],k)||a[c]===k){f=!0;break}f||(a[a.length]=k,c=-1);return c};b.indexInArray=function(a,k){for(var b=0,c=!1;b<a.length;b++)if(a[b]===k){c=!0;break}return c?b:-1};b.removeFromArray=function(a,k){for(var b=
0,c=0;b<a.length;)a[b]===k?(a.splice(b,1),c++):b++;return c};b.addClass=function(a,k){var c;try{a.classList.add(k)}catch(f){null===a.className?a.className=k:(c=a.className.split(" "),b.addToArrayIfNotExist(c,k),a.className=c.join(" "))}};b.removeClass=function(a,k){var c;try{a.classList.remove(k)}catch(f){null===a.className?a.className="":(c=a.className.split(" "),b.removeFromArray(c,k),a.className=c.join(" "))}};b.gevalAndReturn=function(a){var k=y;k.qubitopentagutilsgevalandreturn__var_test__=void 0;
k.qubitopentagutilsgevalandreturn__var_test__error=void 0;b.geval("try{this.qubitopentagutilsgevalandreturn__var_test__=("+a+");}catch(ex){this.qubitopentagutilsgevalandreturn__var_test__error = ex;}");a=k.qubitopentagutilsgevalandreturn__var_test__;var c=k.qubitopentagutilsgevalandreturn__var_test__error;try{k.qubitopentagutilsgevalandreturn__var_test__=void 0,k.qubitopentagutilsgevalandreturn__var_test__error=void 0,delete k.qubitopentagutilsgevalandreturn__var_test__,delete k.qubitopentagutilsgevalandreturn__var_test__error}catch(f){}return{result:a,
error:c}};b.trim=function(a){try{return String(a).trim()}catch(k){return String(a).replace(/^\s+|\s+$/g,"")}};b.setIfUnset=function(a,k){if(a&&k)for(var b in k)k.hasOwnProperty(b)&&!a.hasOwnProperty(b)&&(a[b]=k[b])};b.overrideFromLeftToRight=function(a,k){if(a&&k)for(var b in k)k.hasOwnProperty(b)&&(a[b]=k[b]);return a};b.geval=function(a){return window&&window.execScript?window.execScript(""===a?" ":a):e.eval.call(e,a)};var n=[];b.bodyAvailable=function(a){if(document.body){if(n){for(var k=0;k<n.length;k++)try{n[k]()}catch(b){}n=
!1}a()}else n.push(a)};b.rmCookiesMatching=function(a){for(var k=d.getAll(),b=0;b<k.length;b++){var c=k[b][0];0===c.match(a)&&d.rm(c)}};var r=[],q=!1,w=!1;b.bodyReady=function(a){if(w)return a&&a(),!0;if(q=q||!(!document.body||"complete"!==document.readyState)){w=!0;for(var k=0;k<r.length;k++)try{r[k]()}catch(b){e.console&&e.console.trace&&e.console.trace(b)}a&&a()}else a&&r.push(a);return q};var p=e.onload;e.onload=function(a){try{b.bodyReady()}catch(k){try{window.qubit.opentag.Utils.bodyReady()}catch(c){}}var f=
!1;try{f=p}catch(d){}f&&f(a)};(function(){var a,k=!1,c=1,f,d,e,n;d=function(a){!0===a&&(c-=1);if(!c||!0!==a&&!k){if(!document.body)return setTimeout(d,1);k=!0;if(!0!==a&&(c-=1,0<c))return;for(;0<f.length;)a=f.shift(),a()}};n=function(){if(!k){try{document.documentElement.doScroll("left")}catch(a){setTimeout(n,1);return}d()}};e=function(){if(!f){f=[];if("complete"===document.readyState)return setTimeout(d,1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",
d,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",a);window.attachEvent("onload",d);var k=!1;try{k=null===window.frameElement||void 0===window.frameElement}catch(b){}document.documentElement.doScroll&&k&&n()}}};document.addEventListener?a=function(){document.removeEventListener("DOMContentLoaded",a,!1);d()}:document.attachEvent&&(a=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",a),d())});(function(a){e();k?setTimeout(a,1):f.push(a)})(function(){q=
!0;b.bodyReady()})})()})();(function(){function a(b,c,f){this.collectLogs=!!a.isCollecting();this.collectLocally=f;this.collection=[];this.getPrefix=function(){var a="";c&&("function"===typeof c?a=c(this.ref):c.CLASS_NAME?a=c.CLASS_NAME:c.constructor&&c.constructor.name&&(a=c.constructor.name),a&&(a+=" -> "));return(b||"")+a}}function m(b,c,f,k,e,n,l,g){var q=d>=g;if(0<=a.getCollectLevel()||q)c=e?[k,l,f]:[c+b.getPrefix()+k,n,f],c[3]=g,b.collect(c,g),q&&b.printMessage.apply(b,c)}var g=h.Define,c=null;
g.clazz("qubit.opentag.Log",a);a.LEVEL_FINEST=4;a.LEVEL_FINE=3;a.LEVEL_INFO=2;a.LEVEL_WARN=1;a.LEVEL_ERROR=0;a.LEVEL_NONE=-1;a.MAX_LOG_LEN=1E4;a.prototype.MAX_LOG_LEN=-1;var d=a.LEVEL_NONE,d=a.LEVEL_INFO,b=a.LEVEL_NONE,b=a.LEVEL_FINE,e=!0;a.setLevelFromCookie=function(){var b=h.Cookie.get("qubit.opentag.Log.LEVEL");if(b&&(b=+b,!isNaN(b)&&0<b)){var c=a.LEVEL_FINE;a.setCollectLevel(b>c?b:c);a.setLevel(+b)}};a.setCollecting=function(a){e=!!a};a.isCollecting=function(){return e||a.COLLECT};a.setLevel=
function(a){d=+a};a.setCollectAndLevel=function(b){a.setLevel(b);a.setCollectLevel(b)};a.getLevel=function(){return d};a.setCollectLevel=function(a){b=+a};a.getCollectLevel=function(){return b};var l=[];a.logsCollection=l;a.rePrintAll=function(b,f,e,k){var n=d;void 0!==b&&(d=b);try{if(a.isCollecting()){try{e||c.clear()}catch(t){}var l=k||a.logsCollection,g=0;for(e=0;e<l.length;e++)(function(k){var c=l[k];k=c[3];void 0!==k&&d>=k&&(g++,f?h.opentag.Timed.setTimeout(function(){void 0!==b&&(d=b);try{a.print.apply(a,
c)}finally{d=n}},g*f):a.print.apply(a,c))})(e)}}catch(q){}finally{d=n}};var f=g.global(),n=!!(f.webkitMediaStream||f.webkitURL||f.mozContact);a.isStyleSupported=function(){return n};var r={};a.setConsole=function(a){return c=a||r};a.delayPrint=-1;var q=(new Date).valueOf();a.prototype.printMessage=function(b,c,f,k){if(0<a.delayPrint){var d=a.delayPrint,e=q-(new Date).valueOf();0<e&&(d+=e);try{h.opentag.Timed.setTimeout(function(){this.print(b,c,f,k)}.bind(this),d)}catch(n){setTimeout(function(){this.print(b,
c,f,k)}.bind(this),d)}q=(new Date).valueOf()+d}else this.print(b,c,f,k)};a.prototype.print=function(b,c,f,k){a.print(b,c,f,k)};a.print=function(b,f,e,k){if(!(void 0!==k&&d<k))try{if(c&&c.log)if(f&&a.isStyleSupported())if(e&&c[e])c[e]("%c"+b,f);else c.log("%c"+b,f);else if(e&&c[e])c[e](b);else c.log(b)}catch(n){}};a.prototype.collect=function(b,c){void 0===c&&(c=a.getCollectLevel());var f=!1,k=this.collectLogs&&a.isCollecting()&&a.getCollectLevel()>=+c;k&&(l.push(b),f=!0);this.collectLocally&&k&&(this.collection.push(b),
f=!0);0<a.MAX_LOG_LEN&&l.length>a.MAX_LOG_LEN&&l.splice(0,l.length-a.MAX_LOG_LEN);if(0<a.MAX_LOG_LEN||0<this.MAX_LOG_LEN)k=a.MAX_LOG_LEN,0<this.MAX_LOG_LEN&&(k=this.MAX_LOG_LEN),this.collection.length>k&&this.collection.splice(0,this.collection.length-k);return f?b:null};a.clearAllLogs=function(){try{c.clear()}catch(a){}finally{l.splice(0,l.length)}};a.getCollectedByLevel=function(a,b){b=b||l;for(var c=[],k=0;k<b.length;k++){var f=b[k];f[0][4]===a&&c.push(f)}return c};a.prototype.rePrint=function(b,
c,f){a.rePrintAll(b,c,!f,this.collection)};a.prototype.FINEST=function(b,c){m(this,"FINEST: ",!1,b,c,"color:#CCCCCC;",!1,a.LEVEL_FINEST)};a.prototype.FINE=function(b,c){m(this,"FINE: ",!1,b,c,"color:#999999;",!1,a.LEVEL_FINE)};a.prototype.INFO=function(b,c,f){m(this,"INFO: ","info",b,c,f,f,a.LEVEL_INFO)};a.prototype.WARN=function(b,c){m(this,"WARN: ","warn",b,c,"color:#26A110;",!1,a.LEVEL_WARN)};a.prototype.ERROR=function(b,c){m(this,"ERROR: ","error",b,c,"color:red;",!1,a.LEVEL_ERROR)};a.setConsole(g.global().console);
a.setLevelFromCookie()})();(function(){function a(a){a&&(m.FINEST("Config:"),m.FINEST(a,!0),this._rate=a.rate||10,this._smallestRate=-1,a.start&&this.startPooling(),this.config=a);this.inervals=[];this._lck_obj={};this._binded_pool=this._pool.bind(this)}var m=new h.opentag.Log("Timer -> ");h.Define.clazz("qubit.opentag.Timer",a);a.prototype.timers=[];a.prototype.startPooling=function(a){a&&this.config.dynamic&&(0>this._smallestRate||this._smallestRate>a)&&(this._smallestRate=Math.min(Math.floor(a/
2),1500));this.started||(this.started=!0,setTimeout(this._binded_pool,0))};a.prototype._pool=function(){this.maxFrequent(function(){var a="";this.config&&this.config.name&&(a="["+this.config.name+"]");m.FINEST(a+"Pooling in progress...")},5E3,this._lck_obj);this.callTimers();0!==this.timers.length?setTimeout(this._binded_pool,this._smallestRate>this._rate?this._smallestRate:this._rate):(this.started=!1,this._smallestRate=-1)};a.prototype.callTimers=function(){this.lastCalled=(new Date).valueOf();
for(var a=0;a<this.timers.length;a++){var d=this.timers[a];if((new Date).valueOf()>=d.time){try{d.execute()}catch(b){m.ERROR("Error calling timer: "+b)}this.timers.splice(a,1);--a}}};a.prototype.cancellAll=function(){this.timers=[];m.WARN("Cancelling all stack.")};a.prototype.setRate=function(a){this._rate=a};a.prototype.maxFrequent=function(a,d,b){b||(a.__maxFrequent__timer_opentag_qubit_=a.__maxFrequent__timer_opentag_qubit_||{},b=a.__maxFrequent__timer_opentag_qubit_);var e=b.____last__timed__max__frequent____;
if(!e||(new Date).valueOf()-e>d)e=(new Date).valueOf(),b.____last__timed__max__frequent____=e,a()};a.prototype.runIfNotScheduled=function(a,d,b){b=b||a;if(b.__lastRun__&&(new Date).valueOf()<d+b.__lastRun__)return this.schedule(a,d,b);b.__lastRun__=(new Date).valueOf();a();return!0};a.prototype.schedule=function(a,d,b){if(b.___scheduled___)return!1;b.___scheduled___=(new Date).valueOf();this.setTimeout(function(){b.___scheduled___=!1;b.__lastRun__=(new Date).valueOf();a()},d);return!0};var g=1;a.prototype.setTimeout=
function(a,d){var b={id:g++,time:(new Date).valueOf()+ +d,execute:a};this.timers.push(b);this.startPooling(d);return b};a.prototype.setInterval=function(a,d){m.FINEST("Native wrapper");var b=setInterval(a,d);this.inervals.push(b);return b}})();(function(){h.Define.namespace("qubit.opentag.Timed",new h.opentag.Timer({rate:37,dynamic:!0}));var a=h.opentag.Timed;a.tillTrue=function(m,g,c){var d=function(){m()?g():a.setTimeout(d,c||33)};d()}})();var s;s=s||{};s.fileLoader={};s.fileLoader.load=function(a,
m,g,c,d,b){var e,l,f,n;n=!1;f=function(b){return function(){n||(n=!0,b&&!l&&(l={url:document.location.href}),g(a,l,b))}};try{m&&(e=m(a))}catch(r){e=!1,g(a,"Exception loading pre",!0)}finally{!1!==e&&(m=s.fileLoader.createScriptEl(a,d,!1,b),g&&(m.onload=f(!1),m.onerror=f(!0),m.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||setTimeout(function(){f(!1)()},1)}),c||(c=window.document.getElementsByTagName("head")[0]),c.appendChild(m))}};s.fileLoader.createScriptEl=
function(a,m,g,c){var d,b=document.createElement("script");b.type="text/javascript";b.src=s.fileLoader.tidyUrl(a)+(g?"?"+(new Date).getTime():"");!1!==m?(b.async="true",b.defer="true"):(b.async="false",!1!==b.async&&(b.async=!1),b.defer="false",!1!==b.defer&&(b.defer=!1));for(d in c)c.hasOwnProperty(d)&&b.setAttribute(d,c[d]);return b};s.fileLoader.tidyUrl=function(a){return"http:"===a.substring(0,5)||"https:"===a.substring(0,6)?a:"//"+a};(function(){function a(a){this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+
"["+this.config.name+"]"}.bind(this),"collectLogs");this.config={order:0,include:!0,name:"Filter-"+g++,script:void 0,session:void 0};this.session=null;if(a){for(var b in a)a.hasOwnProperty(b)&&(this.config[b]=a[b]);a.session&&this.setSession(a.session);this.register(this)}}var m=h.opentag.Utils,g=0,c=[];h.Define.clazz("qubit.opentag.filter.BaseFilter",a);a.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};a.prototype.reset=function(){this.enable()};a.prototype.disable=function(){this.config.disabled=
!0};a.prototype.enable=function(){this.config.disabled=!1};a.prototype.match=function(){return!0};a.prototype.setSession=function(a){this.session=a};a.prototype.getSession=function(){return this.session};a.prototype.getState=function(){var c=a.state.PASS;if(this.config.disabled)return a.state.DISABLED;this.config.script&&(c=this.config.script.call(this,c));isNaN(+c)&&(this.log.WARN("filters should use a numerical state as a return for getState(): BaseFilter.state. Filter will fail. Returned: "+c),
c=a.state.FAIL);this.lastState=+c;return c};a.getFilters=function(){return c};a.prototype.register=function(){a.register(this)};a.register=function(a){m.addToArrayIfNotExist(c,a)}})();h.Define.namespace("qubit.opentag.filter.pattern.PatternType",{CONTAINS:"CONTAINS",MATCHES_EXACTLY:"MATCHES_EXACTLY",STARTS_WITH:"STARTS_WITH",ENDS_WITH:"ENDS_WITH",REGULAR_EXPRESSION:"REGULAR_EXPRESSION",ALL_URLS:"ALL_URLS"});(function(){function a(d){this._lockObject={};var b={patternType:c.CONTAINS,pattern:""};if(d)for(var e in d)d.hasOwnProperty(e)&&
(b[e]=d[e]);a.SUPER.call(this,b)}var m=h.opentag.Utils,g=h.opentag.Timed,c=h.opentag.filter.pattern.PatternType;h.Define.clazz("qubit.opentag.filter.URLFilter",a,h.opentag.filter.BaseFilter);a.prototype.PATTERNS=c;a.prototype.getURL=function(a){return a||m.getUrl()};a.prototype.match=function(a){a=this.getURL(a);var b=!0,e=this.config.pattern;switch(this.config.patternType){case c.CONTAINS:b=0<=a.toLowerCase().indexOf(e.toLowerCase());break;case c.MATCHES_EXACTLY:b=a.toLowerCase()===this.config.pattern.toLowerCase();
break;case c.STARTS_WITH:b=0===a.toLowerCase().indexOf(e.toLowerCase());break;case c.ENDS_WITH:b=a.lastIndexOf(e.toLowerCase())+e.length===a.length;break;case c.REGULAR_EXPRESSION:b=(new RegExp(e)).test(a);break;case c.ALL_URLS:b=!0}g.maxFrequent(function(){this.log.FINEST("[ Filter "+this.config.name+"] Checking if patternType '"+this.config.patternType+"' match '"+e+"' pattern: "+(b?"Yes -> "+b:"No")+", include: "+this.config.include)}.bind(this),1E3,this._lockObject);return b}})();(function(){function a(d){var b=
{};if(d){for(var e in d)d.hasOwnProperty(e)&&("customStarter"===e&&d[e]?this.customStarter=d[e]:"customScript"===e&&d[e]&&(this.customScript=d[e]),b[e]=d[e]);this.uid="f"+c++}this.tagsToRun=[];a.SUPER.call(this,b)}var m=h.opentag.filter.BaseFilter,g=h.opentag.Utils,c=0;h.Define.clazz("qubit.opentag.filter.Filter",a,h.opentag.filter.URLFilter);a.prototype.customStarter=function(a,b,c){b(!1)};a.prototype.isSession=function(){return this.config.sessionDisabled||null===this.customStarter&&null===this.customScript?
!1:!0};a.prototype.customScript=function(a){return!0};a.prototype.match=function(c){var b=!0;try{this.customScript&&(void 0===this._matchState&&(this._matchState=!!this.customScript(this.getSession())),b=this._matchState)}catch(e){this.log.FINE("Filter match throws exception:"+e),b=!1}return b&&a.SUPER.prototype.match.call(this,c)};a.prototype.runTag=function(c){g.addToArrayIfNotExist(this.tagsToRun,c);if(this.starterExecuted)this._triggerTag(c);else if(!this._starterWasRun){this._starterWasRun=!0;
var b=function(a){this.reRun=a;this.starterExecuted=(new Date).valueOf();this._processQueuedTagsToRun()}.bind(this);this.customStarter?this.customStarter(this.getSession(),b,c):a.prototype.customStarter.call(this,this.getSession(),b,c)}};a.prototype._processQueuedTagsToRun=function(){for(var a=0;a<this.tagsToRun.length;a++)this._triggerTag(this.tagsToRun[a])};a.prototype._triggerTag=function(a){!0===this.reRun?a.run():a.runOnce()};a.prototype.getState=function(c){c&&this.setSession(c);c=a.SUPER.prototype.getState.call(this);
if(c===m.state.DISABLED)return m.state.DISABLED;c===m.state.PASS&&this.isSession()&&(c=m.state.SESSION);this.config.script&&(c=this.config.script.call(this,c,this.getSession()));return this.lastState=c};a.prototype.reset=function(){this._matchState=void 0;a.SUPER.prototype.reset.call(this);this.starterExecuted=this._starterWasRun=void 0;this.tagsToRun=[];this.reRun=void 0}})();s.GlobalEval={};s.GlobalEval.globalEval=function(a){window.execScript?window.execScript(""===a?" ":a):window.eval.call(window,
a)};s.HtmlInjector={};s.HtmlInjector.inject=function(a,m,g,c,d){var b,e,l,f;if(0<=g.toLowerCase().indexOf("<script")){d=document.createElement("div");d.innerHTML="a"+g;e=d.getElementsByTagName("script");l=[];g=0;for(b=e.length;g<b;g+=1)l.push(e[g]);f=[];g=0;for(b=l.length;g<b;g+=1){e=l[g];var n={attributes:s.HtmlInjector.getAttributes(e)};e.src?n.src=e.src:n.script=e.innerHTML;f.push(n);e.parentNode.removeChild(e)}d.innerHTML&&0<d.innerHTML.length&&(d.innerHTML=d.innerHTML.substring(1));s.HtmlInjector.doInject(a,
m,d);s.HtmlInjector.loadScripts(f,0,c,a)}else d=document.createElement("div"),d.innerHTML=g,s.HtmlInjector.doInject(a,m,d),c&&c()};s.HtmlInjector.doInject=function(a,m,g){if(0<g.childNodes.length){for(var c=document.createDocumentFragment();0<g.childNodes.length;)c.appendChild(g.removeChild(g.childNodes[0]));m?s.HtmlInjector.injectAtStart(a,c):s.HtmlInjector.injectAtEnd(a,c)}};s.HtmlInjector.injectAtStart=function(a,m){0===a.childNodes.length?a.appendChild(m):a.insertBefore(m,a.childNodes[0])};s.HtmlInjector.injectAtEnd=
function(a,m,g){g||(g=1);a===document.body&&"complete"!==document.readyState&&50>g?setTimeout(function(){s.HtmlInjector.injectAtEnd(a,m,g+1)},100):a.appendChild(m)};s.HtmlInjector.loadScripts=function(a,m,g,c){var d,b,e=!1;for(d=a.length;m<d;m+=1)if(b=a[m],b.src){e=!0;break}else s.GlobalEval.globalEval(b.script);e&&s.fileLoader.load(b.src,null,function(){s.HtmlInjector.loadScripts(a,m+1,g,c)},c,!1,b.attributes);g&&m===d&&g()};s.HtmlInjector.getAttributes=function(a){var m,g,c,d,b={};if(a){g=a.attributes;
m=g.length;for(a=0;a<m;a++)c=g[a].value,d=g[a].name.toLowerCase(),""===c||"id"!==d&&"class"!==d&&"charset"!==d&&"data-"!==d.substr(0,5)||(b[d]=c);return b}};(function(){function a(){q=q||{write:document.write,writeln:document.writeln}}function m(){document.write=q.write;document.writeln=q.writeln;q=null}var g=new h.opentag.Log("TagsUtils -> "),c=h.opentag.filter.BaseFilter,d=h.opentag.Utils,b=s.HtmlInjector,e=s.fileLoader,l=h.opentag.filter.Filter,f=function(){};h.Define.clazz("qubit.opentag.TagsUtils",
f);var n=!1;f.bodyLoaded=function(){return n?!0:n=!(!document.body||"loading"===document.readyState)};f.bodyAvailable=function(a){return!!document.body};var r={};f.loadScript=function(a){var k=a.url,b=function(b,c,f){r[k].error=c;f?(g.ERROR("Loading process error:"),g.ERROR(c,!0),r[k].state="failure",a.onerror()):(r[k].state="success",a.onsuccess())};if(r[k]){if(a.noMultipleLoad)return g.FINE(k+" is already loaded, with state: "+r[k].state),b(k,r[k].error,"failure"===r[k].state);r[k].count+=1}else r[k]=
{count:1,state:null};var c=!a.async,n=f.bodyLoaded();c&&n&&g.WARN("Script configured for synchronous injection while document seems to be already loaded. Secure option applies. Script will be appended in standard way.");c&&!n?(g.WARN("Adding script element by using document.write. IE will error check fail broken url's."),f.writeScriptURL(k,function(a,c){b(k,c,!a)})):e.load(k,!1,b,a.node,a.async)};var q=null;f.redirectDocumentWritesToArray=function(k,b){b&&b.FINE("redirecting document.write methods...");
a();document.write=function(a){k.push(a);b&&b.FINE("Received call from document.write with:"+a)};document.writeln=function(a){k.push(a);b&&b.FINE("Received call from document.writeln with:"+a)}};f.flushDocWritesArray=function(a,k,b,c,e){if(k&&a){a=a.splice(0,a.length);try{return f.injectHTML(k,b,a.join("\n"),e||x),!0}catch(n){c&&c.ERROR("Loading html caused exception:"+n)}}else return c&&c.ERROR("Flushing location not found!"),!1;e&&e();return!0};f.unlockDocumentWrites=function(){q&&(g&&g.FINEST("Bringing back document.write"),
m())};var w=f.prototype.PACKAGE_NAME+".TagsUtils._writeScriptURL_callbacks",p={};h.Define.namespace(w,p,y,!0);var u=0,k=(new Date).valueOf();f.writeScriptURL=function(b,c){var n="_"+k+"_"+u++,v=w+"."+n,t=!1;p[n]=function(a){t||(t=!0,a?c(!1,"error while loading script "+b):c(!0),p[n]=void 0,delete f.writeScriptURL.callbacks[n])};var l='if(this.readyState === "loaded" || this.readyState === "complete"){ try {'+v+"(true)} catch (ex) {}}",r="try{"+v+"(false)}catch(ex){}",v="try{"+v+"(true)}catch(ex){}";
b=e.tidyUrl(b);l="<script onload='"+r+"'  onerror='"+v+"' onreadystatechange='"+l+"' type='text/javascript'  src='"+b+"'>\x3c/script>";q?(m(),document.write(l),a()):document.write(l);d.bodyReady(function(){t||(g.WARN("URL loaded but cannot tell if successful: "+b),t=!0,c(!0))})};f.writeScriptURL.callbacks={};var v=c.state.SESSION,t=c.state.PASS,A=c.state.FAIL;f.filtersState=function(a,k,b,f){a=a.sort(function(a,k){try{var b=k.config.order,c=a.config.order;isNaN(-c)&&(c=0);isNaN(-b)&&(b=0);return b-
c}catch(f){return 0}});var e=t;if(!a||0===a.length)return e;for(var e=null,n=!1,d=!1,g=0,q,m,r=[],h,p,u=0;u<a.length;u++)if(h=a[u],h.setSession(k),h.match())if(q=h.getState(),0<q){if(0===g||g>q)g=q}else q===c.state.DISABLED?(b.log.WARN("filter with name "+h.config.name+" is disabled"),n=!0):q===v?(d=!0,m=e=h,r.push(h)):e=h;else p=h;a=!1;null===e?(a=!0,e=n?t:A):e=e.config.include?q:q===t?A:t;0<g&&(e===t||a)&&(e=g);if(e===v||e===t&&d){if(!m.config.include)return A;e=v;if(m instanceof l&&m.isSession()&&
f)for(f=0;f<r.length;f++)try{r[f].runTag(b)}catch(w){r[f].log.FINEST("trying custom starter failed:"+w)}}b.config.dedupe&&e===t&&p&&p instanceof l&&p.isSession()&&(b.sendDedupePing=!0,e=A);return e};f.injectHTML=function(a,k,c,f){return b.inject(a,k?0:1,c,f||x)};f.getHTMLLocationForTag=function(a){a=a.prepareLocationObject(a.config.locationObject);switch(a){case "HEAD":a=document.getElementsByTagName("head")[0];break;case "BODY":a=document.body;break;default:a=a?document.getElementById(a):document.body}return a}})();
(function(){function a(c){this.config={};this.handlers=[];this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+"["+this.uniqueId+"]"}.bind(this),"collectLogs");this.parameters=null;this.callHandlersOnRead=!1;if(c){this.uniqueId="BV"+b++;a.ALL_VARIABLES[this.uniqueId]=this;for(var e in c)c.hasOwnProperty(e)&&(this.config[e]=c[e],"value"===e&&(this.value=c.value));(c=a.register(this))&&c!==this&&(c.log.FINEST("Variable config already registered."),c.log.FINEST("Returning existing one."));
return c}}function m(){if(l)return!1;for(var b=0;b<e.length;b++)try{e[b].getValue()}catch(n){d.ERROR("Value change update exception: "+n)}c.setTimeout(m,a.CHECK_POLL_RATE);return!0}var g=h.opentag.Utils,c=h.opentag.Timed,d=new h.opentag.Log("BaseVariable -> "),b=0;h.Define.clazz("qubit.opentag.pagevariable.BaseVariable",a);a.ALL_VARIABLES={};var e=[];a.OBSERVED_VARIABLES=e;a.pageVariables=[];a.register=function(b){if(b instanceof a){for(var c=0;c<a.pageVariables.length;c++){var e=a.pageVariables[c];
if(b===e)return e}a.pageVariables.push(b);return b}return null};a.prototype.getValue=function(){this._updateCurrentValue(this.value);return this.currentValue};a.prototype._updateCurrentValue=function(a){return this.valuesAreEqual(a,this.currentValue)?!1:(this.oldValue=this.currentValue,this.currentValue=a,l&&!this.callHandlersOnRead||this._handleValueChanged(),!0)};a.prototype.getDefaultValue=function(){return this.defaultValue};a.prototype.setDefaultValue=function(a){this.defaultValue=a};a.prototype.exists=
function(a){var b=g.variableExists(this.getValue());a&&(b=b||g.variableExists(this.getDefaultValue()));return b};a.prototype.getRelativeValue=function(a,b){var c=this.getValue();g.variableExists(c)||(c=b);var e;a&&!g.variableExists(c)&&(e=this.getDefaultValue(),g.variableExists(e)&&(c=e));return c};a.prototype.replaceToken=function(a,b,c,e){var d=this.exists();c=d?this.getValue():c;a="\\$\\{"+a+"\\}";return e||c instanceof Array?(e=d?this.getValueAccessorString():g.getAnonymousAcessor(c),b.replace(new RegExp(a,
"g"),e)):b.replace(new RegExp(a,"g"),c)};a.prototype.getAccessorString=function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};a.prototype.getValueAccessorString=function(){return this.getAccessorString()+".getValue()"};a.prototype.onValueChanged=function(a,b){-1===g.addToArrayIfNotExist(this.handlers,a)&&this.log.FINE("Attached value changed handler: "+a);!1!==b&&this.startObservingForChanges()};a.prototype.deatchOnValueChanged=function(a){0<g.removeFromArray(this.handlers,
a)&&this.log.FINE("Dettached value changed handler: "+a)};a.prototype._handleValueChanged=function(){for(var a={oldValue:this.oldValue,newValue:this.currentValue,variable:this},b=0;b<this.handlers.length;b++)try{this.handlers[b](a)}catch(c){this.log.ERROR("Error while calling qprotocol variable change handler: "+c)}};var l=!0;a.CHECK_POLL_RATE=333;a.prototype.startObservingForChanges=function(){this.addToObservedVariables();l&&(l=!1,m())};a.prototype.stopObservingForChanges=function(){this.removeFromObservedVariables();
0===e.length&&(l=!0)};a.prototype.addToObservedVariables=function(){g.addToArrayIfNotExist(e,this)};a.prototype.removeFromObservedVariables=function(){g.removeFromArray(e,this)};a.prototype.getObservedVariables=function(){return e};a.prototype.valuesAreEqual=function(a,b){return a===b}})();(function(){function a(c){this._lockExprObject={};a.SUPER.apply(this,arguments)}var m=h.opentag.Utils,g=h.opentag.Timed;h.Define.clazz("qubit.opentag.pagevariable.Expression",a,h.opentag.pagevariable.BaseVariable);
a.prototype.getValue=function(){var c,d,b=this.value;try{if(b&&-1===b.indexOf("[#]")){var e=m.gevalAndReturn(b);c=e.result;this.failMessage=null;d=e.error}else c=a.parseUVArray(b)}catch(l){d=l}d&&(d="could not read value of expression: \n"+b+"\nexact cause: "+d,this.failMessage!==d&&(this.failMessage=d),c=null);this._updateCurrentValue(c)&&g.maxFrequent(function(){this.failMessage&&this.log.FINEST(this.failMessage);this.log.FINEST("getting value from expression: "+c)}.bind(this),1E4,this._lockExprObject);
return c};a.parseUVArray=function(a){var d=a.split("[#]");a=m.gevalAndReturn(d[0]).result;var b=[],d=d[1];0===d.indexOf(".")&&(d=d.replace(".",""));for(var e=0;e<a.length;e++){var g=m.getObjectUsingPath(d,a[e]);b.push(g)}return b};a.prototype.replaceToken=function(c,d,b,e){this.getValue()instanceof Array&&(e=!0);return a.SUPER.prototype.replaceToken.call(this,c,d,b,e)}})();(function(){function a(g){a.SUPER.apply(this,arguments)}var m=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.DOMText",
a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){this.log.FINEST("reading DOM element contents value");var a=m.getElementValue(this.value);this._updateCurrentValue(a);return a}})();(function(){function a(g){a.SUPER.apply(this,arguments);this._lockObject={}}var m=h.opentag.Timed;h.Define.clazz("qubit.opentag.pagevariable.Cookie",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var a=h.Cookie.get(this.value);m.maxFrequent(function(){this.log.FINEST("reading cookie value: "+
a)}.bind(this),2E3,this._lockObject);this._updateCurrentValue(a);return a}})();(function(){function a(g){a.SUPER.apply(this,arguments)}var m=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.URLQuery",a,h.opentag.pagevariable.BaseVariable);a.prototype.getValue=function(){var a=m.getQueryParam(this.value);this._updateCurrentValue(a);return a}})();(function(){function a(){}function m(a,b){var c=[];try{var f=a.parameters;if(f)for(var k=0;k<f.length;k++)a.getVariableForParameter(f[k])===b&&c.push(f[k])}catch(e){}return c}
var g=h.opentag.Utils,c=h.opentag.TagsUtils,d=h.opentag.Timed,b=h.opentag.pagevariable.BaseVariable,e=h.opentag.pagevariable.Expression,l=h.opentag.pagevariable.DOMText,f=h.opentag.pagevariable.Cookie,n=h.opentag.pagevariable.URLQuery;h.Define.clazz("qubit.opentag.TagHelper",a);a.injectHTMLForLoader=function(a,b,f,e){if(e=void 0!==e?e:a.getHtml()){var k="END"===a.config.locationPlaceHolder,d=c.getHTMLLocationForTag(a);a.log.FINE("injecting html into page:");a.log.FINE(e);a.injectHTMLNotFinished=!0;
try{d?c.injectHTML(d,k,e,function(){a.log.FINE("finished html injection.");a.injectHTMLNotFinished=!1;if(b)try{b()}catch(k){a.log.ERROR("error while trying to run callback after html injection: "+k)}}.bind(a)):f&&"loading"===document.readyState?(document.write(e),a.injectHTMLNotFinished=!1):(a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("location was not found or/and html is told to not to write at runtime or document is already loaded. Please check tag's configuration. Injection cancelled."))}catch(n){a.injectHTMLNotFinished=
!1,a.injectHTMLFailed=(new Date).valueOf(),a.log.ERROR("error while trying to inject html: "+n)}}};a.getAllVariablesWithParameters=function(a){for(var b=a.getPageVariables(),c=[],f=0;f<b.length;f++)for(var k=b[f],e=m(a,k),d=0;d<e.length;d++)c.push({parameter:e[d],variable:k});return c};var r={};a.allParameterVariablesReadyForTag=function(a,b){for(var c=a.log,f=!0,k=a.getPageVariables(),e=0;e<k.length;e++){var n=k[e];try{var l=m(a,n),g=n.exists();!g&&b&&(0<l.length&&(g=!!l[0].defaultValue),g=g||n.exists(!0));
var h=n.config.name?n.config.name:"[unnamed]";d.maxFrequent(function(){c.FINEST("Variable '"+h+"' exists? "+g)},5E3,r);if(!g){f=!1;break}}catch(s){d.maxFrequent(function(){c.ERROR("Error checking variable existence ");c.ERROR([n,s])},5E3,r);f=!1;break}}f&&!r.alreadyNotified&&(r={alreadyNotified:!0});d.maxFrequent(function(){c.FINEST("Checking page variables, variables are ready: "+f);f?(r.clear=!0,c.FINE("Variables ready.")):c.FINE("Variables not ready, waiting...")},2E3,r);return f};a.validateAndGetVariableForParameter=
function(b){b.hasOwnProperty("variable")&&b.variable&&(b.variable=a.initPageVariable(b.variable));return b.variable};a.initPageVariable=function(a){if(!a||a instanceof b)return a;if("string"===typeof a){var c=g.getObjectUsingPath(a);if(c&&c instanceof b)return c}switch(a.type){case "2":return new e(a);case "3":return new n(a);case "4":return new f(a);case "5":return new l(a);case "EPRESSION":return new e(a);case "URL_PARAMETER":return new n(a);case "COOKIE_VALUE":return new f(a);case "DOM_VALUE":return new l(a);
default:return new b(a)}}})();(function(){function a(a){this.log=new h.opentag.Log("Events -> ");this.calls={}}var m=h.Define,g=h.opentag.Utils;a.prototype.on=function(a,d){this.calls[a]||(this.calls[a]=[]);return g.addToArrayIfNotExist(this.calls[a],d)};a.prototype.call=function(a,d){var b=this.calls[a];if(b)for(var e=0;e<b.length;e++)try{b[e](d)}catch(l){this.log.ERROR("Error while running event: "+l)}};a.prototype.remove=function(a,d){return this.calls[a]?g.removeFromArray(this.calls[a],d):null};
a.prototype.removeAll=function(a){var d=0,b;for(b in this.calls)this.calls.hasOwnProperty(b)&&(d+=g.removeFromArray(this.calls[b],a));return d};a.prototype.clear=function(){this.calls={}};m.clazz("qubit.Events",a)})();(function(){function a(a){this.log=new l("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),"collectLogs");this.runCounter=this.urlsFailed=this.urlsLoaded=0;this.events=new h.Events({});this._depLoadedHandler=function(){this.dependenciesLoaded()&&this.awaitingDependencies&&
(this.log.FINE("All dependencies has run successfuly. Triggering load."),this._triggerLoadingAndExecution())}.bind(this);this.config={name:"Tag-"+e++,async:!0,usesDocumentWrite:!1,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,dontWaitForInjectionLocation:!1,noMultipleLoad:!1,loadDependenciesOnLoad:!1};this.delayDocWrite=!1;this.dependencies=[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=[];
if(a){this.log.FINE("instance...");if(!a.name){var b="Tag-"+e++;this.config.name=b;this.log.WARN("Name was not specified for tag. Assigning auto: "+b)}this.addState("INITIAL");for(var c in a)this.config[c]=a[c];a.genericDependencies&&(this.genericDependencies=this.genericDependencies.concat(a.genericDependencies));a.dependencies&&(this.dependencies=a.dependencies.concat(this.dependencies));a.PACKAGE&&(this._package=a.PACKAGE);this.onInit()}}function m(){if(this.cancelled)this._handleCancel();else{this.waitForDependenciesFinished=
(new Date).valueOf();var a=this._fullBodyNeededAndUnLoaded(),b=this._bodyNeededButNotAvailable();a||b?this.waitForDependenciesFinished=!1:(this.timeoutCountdownStart||(this.timeoutCountdownStart=(new Date).valueOf()),this.allDependenciesLoaded()?this._markLoadedSuccesfuly():this._loadingOutOfTimeFrames()?(this.loadingTimedOut=(new Date).valueOf(),this.allDependenciesLoaded(!0)?this._markLoadedSuccesfuly():(this.log.WARN("timed out while loading dependencies."),this.addState("TIMED_OUT"),this._markLoadingDependenciesFailed(),
this._triggerOnLoadTimeout())):this.waitForDependenciesFinished=!1);if(this.waitForDependenciesFinished)this.addState("LOADED_DEPENDENCIES");else{this._setTimeout(m.bind(this),65);var c=((new Date).valueOf()-this.loadStarted)/this.getTimeout(),e=Math.ceil(this.getTimeout()/3E3);this._lockObject.curr=c;d.maxFrequent(function(){a&&this.log.FINE("Full body needed. Waiting for full body.");b&&this.log.FINE("Interactive body needed. Waiting for body.");this.log.FINE("Waiting for dependencies, counting... "+
this._lockObject.count++ +" ("+e+")")}.bind(this),3E3,this._lockObject)}}}var g=h.opentag.Utils,c=h.opentag.TagsUtils,d=h.opentag.Timed,b=h.opentag.TagHelper,e=0,l=h.opentag.Log;h.Define.clazz("qubit.opentag.GenericLoader",a);a.prototype.onInit=x;a.prototype.LOADING_TIMEOUT=5E3;a.prototype.getHtml=function(){return this.config.html?this.config.html:this.htmlContent?g.trim(this.htmlContent):null};a.prototype._executeScript=function(){this.log.INFO("executing main script...");var a=!1;try{this.script(),
a=!0,this.log.INFO("executed without errors.")}catch(b){this.addState("EXECUTED_WITH_ERRORS"),this.executedWithErrors=(new Date).valueOf(),this.log.ERROR("Error while executing: "+b),this.log.ERROR("There was an error while executing instance of tag: "+this.CLASS_NAME+" from package: "+this.PACKAGE_NAME),this.log.ERROR(b,!0),this._onError(b)}finally{this._onExecute(a)}};a.prototype.getTimeout=function(){return this._getTimeout()};a.prototype._getTimeout=function(a){var b=+this.config.timeout,c=this.dependencies;
if(-1!==b&&0<c.length){var e=0;a=a||[];if(-1===g.indexInArray(a,this)){a[a.length]=this;for(var d=0;d<c.length;d++){var l=c[d]._getTimeout(a);l>e&&(e=l)}0<e&&(b+=e)}else return 0}return b};a.prototype._onExecute=function(a){this.onExecute(a)};a.prototype.onExecute=x;a.prototype._flushDocWrites=function(a){var b=!0;this._docWriteNotFlushed=!1;try{var e=c.getHTMLLocationForTag(this);e&&this._securedWrites&&0<this._securedWrites.length&&(this.log.FINE("flushing document.write proxy array"),this.log.FINE("flushing: "+
this._securedWrites.join("\n")),(b=c.flushDocWritesArray(this._securedWrites,e,"END"===this.config.locationPlaceHolder,this.log,a))?this._docWriteFlushed=(new Date).valueOf():this._docWriteNotFlushed=(new Date).valueOf())}catch(d){this.log.ERROR("Unexpected exception during flushing! "+d),this._onError(d)}a&&a();this._securedWrites&&0<this._securedWrites.length&&(b=!1,this._docWriteNotFlushed=(new Date).valueOf());return b};a.prototype.log=x;a.prototype.finished=function(){return!!this.runIsFinished};
a.prototype.script=function(){this.log.INFO("Script run.")};a.prototype.before=function(){this.log.FINE("running before handler...");this.beforeRun=(new Date).valueOf();try{this.events.call("before",this)}catch(a){this.log.ERROR("onBefore error: "+a),this._onError(a)}};a.prototype.onBefore=function(a){this.events.on("before",a)};a.prototype.after=function(a){this.log.FINE("running after...");this.afterRun=(new Date).valueOf();try{this.events.call("after",{success:a,tag:this})}catch(b){this.log.ERROR("onAfter error: "+
b),this._onError(b)}};a.prototype.onAfter=function(a){this.events.on("after",a)};a.prototype.runOnce=function(){this._runOnceTriggered||this.scriptExecuted||(this._runOnceTriggered=(new Date).valueOf(),this.run())};a.CANCEL_ALL=!1;a.prototype.run=function(){if(!isNaN(this.config.runningLimit)&&this.config.runningLimit<=this.runCounter)return this.log.FINE("running has been stopped as limit is reached."),!1;if(this.cancelled||a.CANCEL_ALL)return this._handleCancel(),!1;if(this.isRunning)return this.log.FINE("loader is currently in progress, try again later."),
!1;this.lastRun&&(this.log.FINE("Running again. Run count: "+(this.runCounter+1)),this.reset());this.lastRun=this.isRunning=(new Date).valueOf();this.runCounter++;this._ignoreDeps=!!this.ignoreDependencies;return this._ignoreDeps||this.dependenciesLoaded()?this._triggerLoadingAndExecution():(this.log.FINE("Dependencies (other loaders) not ready. Attaching handlers."),this._attachDepsEventsToContinue(),!1)};a.prototype._triggerLoadingAndExecution=function(){this.awaitingDependencies=-(new Date).valueOf();
this.load();this._ignoreDeps?this.execute():this.waitForDependenciesAndExecute();return!0};a.prototype._attachDepsEventsToContinue=function(){this.log.FINE("Attaching success events to dependencies...");this.awaitingDependencies=(new Date).valueOf();for(var a=this.dependencies,b=0;b<a.length;b++)try{a[b].events.on("success",this._depLoadedHandler)}catch(c){this.log.WARN("Cannot set event for dependency -> ",a[b]),this.log.WARN("Exception: ",c)}this.log.FINE("Attached "+a.length+" handlers.")};a.prototype.dependenciesLoaded=
function(){for(var a=this.dependencies,b=0;b<a.length;b++)if(a[b]!==this&&!(0<+a[b].scriptExecuted))return!1;return!0};a.prototype._setTimeout=function(a,b){this._wasTimed=(new Date).valueOf();return d.setTimeout(a,b)};a.prototype._handleCancel=function(){this.addState("CANCELLED");this.log.INFO("loader is cancelled.");try{this.onCancel()}catch(a){this.log.ERROR("Exception at onCancel"+a),this._onError(a)}};a.prototype.waitForDependenciesAndExecute=function(){this.cancelled?this._handleCancel():this.loadedDependencies?
this.execute():this.loadingDependenciesFailed?(this.log.INFO("script execution failed before running: dependencies failed to load."),this._markFailure(),this._markFinished()):this._setTimeout(this.waitForDependenciesAndExecute.bind(this),30)};a.prototype.execute=function(){this.log.FINE("entering execute...");this._triggerExecution()};a.prototype._triggerExecution=function(){if(this.cancelled)this._handleCancel();else if(!this.scriptExecuted){var a=!0;if(this.shouldWaitForDocWriteProtection())a=!1;
else{if(!this._beforeEntered){this._beforeEntered=(new Date).valueOf();a=!1;try{a=this.before()}catch(b){this.log.ERROR("`before` thrown an exception"),this.log.ERROR(b,!0),this._onError(b)}if(a){this.log.INFO("before callback cancelled execution.");this._markFailure();this._markFinished();return}}a=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(!this.scriptExecuted)if(this.unexpectedFail&&(a=!0),a){this._flushDocWrites();this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail?
this._markFailure():(this.log.FINE("Executing..."),this.scriptExecuted=(new Date).valueOf(),this.addState("EXECUTED"),this._executeScript());if(this.cancelled)return this._handleCancel(),!1;a=0<this.scriptExecuted;try{this.afterRun||(this.afterRun=(new Date).valueOf(),this.after(a))}catch(c){this.executedWithErrors=(new Date).valueOf()}this.executedWithErrors||a&&this.events.call("success");this._flushDocWrites();this._markFinished();this.log.INFO("* stopped ["+(0<this.scriptExecuted?"executed":"not executed")+
"] *")}else this._setTimeout(this._triggerExecution.bind(this),30)}};a.prototype._markFailure=function(){this.log.INFO("Script execution failed.");this.scriptExecuted=-(new Date).valueOf();this.addState("FAILED_TO_EXECUTE")};a.prototype._markFinished=function(){this.runIsFinished=(new Date).valueOf();this.isRunning=!1;a.LOCK_DOC_WRITE===this&&(this._flushDocWrites(),c.unlockDocumentWrites(),a.LOCK_DOC_WRITE=!1);this.onFinished(!0)};a.prototype.onFinished=x;a.prototype.onCancel=x;a.prototype.onFinished=
x;a.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite())if(!a.LOCK_DOC_WRITE)a.LOCK_DOC_WRITE=this,this._secureWriteAndCollectForExecution();else if(a.LOCK_DOC_WRITE!==this)return this._lockedDocWriteInformed||(this._lockedDocWriteInformed=(new Date).valueOf(),this.log.WARN("Tag will wait till document.write be available."),this.log.FINE(a.LOCK_DOC_WRITE,!0)),!0;return!1};a.prototype.runWithoutDependencies=function(){this.ignoreDependencies=!0;this.run()};a.prototype.loadExecutionURLsAndHTML=
function(a){if(this.cancelled)return this._handleCancel(),!0;this._loadExecutionURLsAndHTMLInformed||(this._loadExecutionURLsAndHTMLInformed=!0,this.log.INFO("tag is loaded, trying execution..."));this._triggerURLsLoading(a);return this.loadURLsNotFinished||(this._flushDocWrites(),this._triggerHTMLInjection(),this._flushDocWrites(),this.injectHTMLNotFinished||(this._flushDocWrites(),this.log.INFO("url and html awaiting has ended..."),this._docWriteNotFlushed))?!1:(this._docWriteFlushed&&this.log.INFO("flushed document.write..."),
!0)};a.prototype._triggerURLsLoading=function(a){!this._urlLoadTriggered&&this.config.url&&(this._urlLoadTriggered=!0,this.log.INFO("tag has url option set to: "+this.config.url),this.log.INFO("loading url and delaying execution till link is loaded"),this.loadURLs(!1,a))};a.prototype._triggerHTMLInjection=function(){!this._injectHTMLTriggered&&this.getHtml()&&(this._injectHTMLTriggered=!0,this.log.FINE("tag has html option set to: "+this.getHtml()),this.log.INFO("injecting html and delaying execution till is ready"),
this.injectHTML())};a.prototype.STATE={INITIAL:0,STARTED:1,LOADING_DEPENDENCIES:2,LOADED_DEPENDENCIES:4,LOADING_URL:8,LOADED_URL:16,EXECUTED:32,EXECUTED_WITH_ERRORS:64,FAILED_TO_LOAD_DEPENDENCIES:128,FAILED_TO_LOAD_URL:256,FAILED_TO_EXECUTE:512,TIMED_OUT:1024,UNEXPECTED_FAIL:2048,CANCELLED:4096};a.prototype.addState=function(a){if(this.STATE.hasOwnProperty(a)){this.state|=this.STATE[a];try{this.onStateChange(a)}catch(b){this.log.ERROR(b),this._onError(b)}}};a.prototype.onStateChange=x;a.prototype.cancel=
function(){this.cancelled=(new Date).valueOf()};a.prototype.unCancel=function(){this.cancelled=void 0};a.prototype.state=a.prototype.STATE.INITIAL;a.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=(new Date).valueOf();this.onAllDependenciesLoaded()};a.prototype._secureWriteAndCollectForExecution=function(){this._securedWrites||(this._securedWrites=[],c.redirectDocumentWritesToArray(this._securedWrites,this.log))};a.prototype._markLoadingDependenciesFailed=function(){this.addState("FAILED_TO_LOAD_DEPENDENCIES");
this.loadingDependenciesFailed=(new Date).valueOf()};a.prototype.allDependenciesLoaded=function(a,b){return 0===this.getDependenciesToBeLoaded(a,b).length};a.prototype.getDependenciesToBeLoaded=function(a,b){var c=b||[];this.injectionLocationReady()||c.push("injection location");var e,l=this.dependencies;for(e=0;e<l.length;e++)l[e]!==this&&(0<+l[e].scriptExecuted||c.push("dependant Tag with name -> "+(l[e].config?l[e].config.name:"anonymous")));for(e=0;e<this.genericDependencies.length;e++)this.genericDependencies[e](this)||
c.push("this.genericDependencies["+e+"] (index: "+e+")");""!==c&&d.maxFrequent(function(){var a=c.join(", ");a?this.log.FINE("Dependencies check: Waiting for: "+a):this.log.FINE("Dependencies check: No basic dependencies.")}.bind(this),5E3,this._lockObjectDepsLoaded);return c};a.prototype.docWriteAsksToWaitForBody=function(){return!(!this.delayDocWrite||!this.config.usesDocumentWrite)};a.prototype._bodyNeededButNotAvailable=function(){return this._dontWaitForInjections()?!1:this._isBodyLocationNeeded()&&
!c.bodyAvailable()};a.prototype._isBodyLocationNeeded=function(){return this.isLoadingAsynchronously()?this._isBodyLocationSet()?!0:"HEAD"===this.config.locationObject&&"END"===this.config.locationPlaceHolder:!1};a.prototype._isBodyLocationSet=function(){var a=this.config.locationObject;return!a||"BODY"===a};a.prototype._fullBodyNeededAndUnLoaded=function(){if(this._dontWaitForInjections())return!1;var a=!1;this._isBodyLocationNeeded()&&(a="END"===this.config.locationPlaceHolder);return(a=a||this.fullbodyNeeded||
this.docWriteAsksToWaitForBody())&&!g.bodyReady()};a.prototype._dontWaitForInjections=function(){return this.config.dontWaitForInjectionLocation||this.dontWaitForInjectionLocation||a.dontWaitForInjectionLocation};a.prototype.injectionLocationReady=function(){return this._dontWaitForInjections()?!0:this._fullBodyNeededAndUnLoaded()?!1:this.isLoadingAsynchronously()?!!c.getHTMLLocationForTag(this):!0};a.prototype._loadingOutOfTimeFrames=function(){return 0>this.getTimeout()?!1:(new Date).valueOf()-
this.timeoutCountdownStart>this.getTimeout()};a.prototype.loadDependencies=function(){this._loadDependencies()};a.prototype.addClientDependenciesList=function(a,b){return this.addDependenciesList(a,h.Define.clientSpaceClasspath())};a.prototype.addDependenciesList=function(b,c){if(b&&0!==b.length){this.failedDependenciesToParse||(this.failedDependenciesToParse=[]);for(var e=this.dependencies,d=0;d<b.length;d++){var l=b[d],m=!1;if(l instanceof a)e.push(l);else if("string"===typeof l){var h=l;c&&(l=
c+"."+l);var k=g.getObjectUsingPath(l);k?k instanceof a?e.push(k):m=!0:this.failedDependenciesToParse.push(h)}else m=!0;m&&(this.log.WARN("Bad object type passed to deps, ignoring."),this.badDepsObjects=this.badDepsObjects||[],g.addToArrayIfNotExist(this.badDepsObjects,l))}}};a.prototype._loadDependencies=function(a){a=a||[];var b=this.dependencies;if(-1===g.indexInArray(a,this)){a[a.length]=this;for(var c=0;c<b.length;c++)b[c].load(a)}};a.prototype.onError=x;a.prototype._onError=function(a){try{this.onError(a)}catch(b){}};
a.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};a.prototype.onLoadTimeout=x;a.prototype.onScriptsLoadSuccess=x;a.prototype.onScriptLoadError=x;a.prototype.onAllDependenciesLoaded=x;a.prototype.onBeforeLoad=null;a.prototype.load=function(){if(!this.loadStarted){this.loadStarted=(new Date).valueOf();try{if(this.onBeforeLoad)this.onBeforeLoad()}catch(a){this.log.ERROR("onBeforeLoad error: "+a),this._onError(a)}this.addState("LOADING_DEPENDENCIES");this.log.INFO("Load started.");try{!this._ignoreDeps&&
this.config.loadDependenciesOnLoad&&this.loadDependencies()}catch(b){throw this.log.ERROR("loadDependencies: unexpected exception occured: \n"+b+"\ntrying to finish... "),b;}m.call(this)}};a.prototype._singleUrlLoadHandler=function(a,b,c){++this.urlsLoaded;a||++this.urlsFailed;if(this.urlsLoaded===b.length)if(this.loadURLsNotFinished=!1,a&&0===this.urlsFailed){this.log.INFO("succesfully loaded "+this.urlsLoaded+" urls.");this.addState("LOADED_URL");this.urlsLoaded=(new Date).valueOf();try{c&&c(!0)}catch(e){this.log.ERROR("Callback error:"+
e),this._onError(e)}finally{this.onScriptsLoadSuccess()}}else{a="error loading urls. Failed "+this.urlsFailed;this.log.ERROR(a);this._onError(a);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-(new Date).valueOf();try{this.scriptLoadingFailed=!0,c&&c(!1)}catch(d){this.log.ERROR("Callback error:"+d),this._onError(d)}finally{this.onScriptLoadError(a)}}};a.prototype.loadURLs=function(a,b){var c=a||this.config.url;this.addState("LOADING_URL");this.log.FINE("loading URL(s) ...");try{!c||c instanceof
Array||(c=[c]);for(var e=0;e<c.length;e++){this.loadURLsNotFinished=!0;var d=c[e],d=this.prepareURL(d);this.log.FINE("loading URL: "+d+" ...");this.loadURL(d,function(a){this._singleUrlLoadHandler(a,c,b)}.bind(this))}}catch(l){this.log.ERROR("loadURLs thrown unexpected exception! : "+l),this.loadURLsNotFinished=!1,this.addState("UNEXPECTED_FAIL"),this.unexpectedFail=(new Date).valueOf(),this._onError(l)}};a.prototype.prepareLocationObject=function(a){return a};a.prototype.prepareURL=function(a){return a};
a.prototype.prepareHTML=function(a){return a};a.prototype.loadURL=function(a,b,e){this.addState("LOADING_URL");c.loadScript({onsuccess:function(){this.log.FINE("succesfully loaded "+a);try{b&&b(!0)}catch(c){this.log.ERROR("error at callback for "+a+":"+c)}}.bind(this),onerror:function(){this.log.ERROR("error loading "+a);try{b&&b(!1)}catch(c){this.log.ERROR("error at callback for error at "+a+":"+c)}}.bind(this),url:a,node:e||this.config.urlLocation,async:this.isLoadingAsynchronously(),noMultipleLoad:this.config.noMultipleLoad})};
a.prototype.reset=function(){this.log.FINE("resetting.");this._securedWrites=this.delayDocWrite=this.scriptLoadingFailed=this.scriptExecuted=this.runIsFinished=this.loadingTimedOut=this.loadingDependenciesFailed=this.loadedDependencies=this.loadURLsNotFinished=this.loadStarted=this.injectHTMLFailed=this.filtersRunTriggered=this.beforeRun=this.afterRun=this._urlLoadTriggered=this._runOnceTriggered=this._lockedDocWriteInformed=this._loadExecutionURLsAndHTMLInformed=this._injectHTMLTriggered=void 0;
this.state=0;this.unexpectedFail=void 0;this.urlsLoaded=this.urlsFailed=0;this.timeoutCountdownStart=this.awaitingDependencies=this._beforeEntered=this.cancelled=this._lastRun=this.isRunning=this.waitForDependenciesFinished=void 0;this.addState("INITIAL")};a.prototype.isLoadingAsynchronously=function(){return this._wasTimed?!0:!(!this.config.async&&!this.forceAsynchronous)};a.prototype.willSecureDocumentWrite=function(){return this.config.usesDocumentWrite&&this.isLoadingAsynchronously()};a.prototype.injectHTML=
function(a){var c=!this.docWriteAsksToWaitForBody(),e=this.prepareHTML(this.getHtml());e&&b.injectHTMLForLoader(this,a,c,e)};a.prototype.clone=function(){return new a(this.config)}})();(function(){function a(b){g.setIfUnset(b,{filterTimeout:b&&b.filterTimeout||this.FILTER_WAIT_TIMEOUT,PACKAGE:b&&b.PACKAGE,dedupe:!1,needsConsent:!1,inactive:!1,variables:null,runner:null,disabled:!1,locked:!1,reRunOnVariableChange:!1});a.SUPER.apply(this,arguments);this.namedVariables={};this.parameters=[];this.filters=
[];this.session=null;this.pingSent=!1;this.reRunCounter=0;if(b){this.addState("INITIAL");try{a.register(this)}catch(c){this.log.WARN("Problem with registering tag "+this.config.name),this.log.WARN(c,!0)}this.setupConfig(b);this.uniqueRefString=null;if(b.init)try{b.init.call(this,b)}catch(e){this.log.ERROR("init call failed:"+e)}this.onTagInit();this.handleVariableChange=this._handleVariableChange.bind(this)}}function m(a,b){var c=a.namedVariables,d=e.initPageVariable(c[b]);return c[b]=d}var g=h.opentag.Utils,
c=h.opentag.TagsUtils,d=h.opentag.filter.BaseFilter,b=h.opentag.GenericLoader,e=h.opentag.TagHelper,l=h.opentag.pagevariable.BaseVariable,f=h.Cookie,n=h.Define,r=new h.opentag.Log("BaseTag -> ");n.clazz("qubit.opentag.BaseTag",a,b);a.prototype.setupConfig=function(a){if(a){a.filters&&this.addFilters(a.filters);a.parameters&&this.addParameters(a.parameters);if(a.variables)for(var b in a.variables)if(a.variables.hasOwnProperty(b)){var c=this.getParameterByTokenName(b);if(c){var e=a.variables[b];c.variable=
e;void 0!==e.defaultValue&&(c.defaultValue=e.defaultValue);void 0!==e.uv&&(c.uv=e.uv)}}a.locked&&this.lock()}};a.prototype.valueForToken=function(a,b){var c=this.getParameterByTokenName(a);if(c)return void 0===b&&this.loadingTimedOut&&(b=!0),this.getParameterValue(c,b);if((c=this.namedVariables)&&c[a]&&(c=m(this,a)))return c.getRelativeValue(b)};a.prototype.addParameters=function(a){this.parameters=this.parameters.concat(a)};a.prototype.LOADING_TIMEOUT=5E3;a.prototype.FILTER_WAIT_TIMEOUT=-1;a.prototype._isVariable=
function(a){return null!==a&&void 0!==a};a.prototype.run=function(){if(this.destroyed)throw"Tag is destroyed.";this.resolveAllDynamicData();var a=this.parameters;if(a)for(var b=0;b<a.length;b++){var c=this.getVariableForParameter(a[b]);if(!this._isVariable(c)){this.log.ERROR("Parameter is missing variable!");this.log.ERROR(a[b]);this._markLoadingDependenciesFailed();this._markFinished();return}}if(this.config.runner){a=!1;try{this.log.INFO("Running custom runner..."),this.addState("AWAITING_CALLBACK"),
a=this._runner=(new Date).valueOf(),this.config.runner.call(this)}catch(e){this.log.ERROR("Error while running custom runner: "+e)}return a}this._runner=!1;return this.start()};a.prototype.lock=function(){this.locked=!0;this._unlock=null};a.prototype.unlock=function(){this.locked=!1;this._unlock&&(this._unlock(),this._unlock=!1)};a.prototype.start=function(){return this.locked?(this.log.WARN("Tag is locked. Running delegated."),this._unlock=function(){return a.SUPER.prototype.run.call(this)}.bind(this),
!1):a.SUPER.prototype.run.call(this)};a.prototype.startOnce=function(){return this.locked?(this._unlock=function(){return a.SUPER.prototype.runOnce.call(this)}.bind(this),!1):a.SUPER.prototype.runOnce.call(this)};a.prototype.getFilters=function(){return this.filters};a.prototype.runOnceIfFiltersPass=function(){this._runOnceIfFiltersPassTriggered||this.scriptExecuted||(this._runOnceIfFiltersPassTriggered=(new Date).valueOf(),this.runIfFiltersPass())};a.prototype.runIfFiltersPass=function(){if(this.destroyed)throw"Tag is destroyed.";
this.resolveAllDynamicData();var a=this.filtersState(!0);this.addState("FILTER_ACTIVE");this.filtersRunTriggered||(this.filtersRunTriggered=(new Date).valueOf());if(a===d.state.SESSION)this.addState("AWAITING_CALLBACK"),this.log.FINE("tag is in session and will be manually triggered by custom starter"),this.awaitingCallback=(new Date).valueOf();else if(a===d.state.PASS){this.filtersPassed=(new Date).valueOf();this.log.FINE("tag passed filters tests");try{this.onFiltersPassed()}catch(b){this.log.ERROR("error running onFiltersDelayed:"+
b)}this.run()}else if(a===d.state.FAIL)this.log.FINE("tag failed to pass filters"),this._markFiltersFailed(),this._markFinished();else if(0<a){var c=this.config.filterTimeout;if(0>c||(new Date).valueOf()-this.filtersRunTriggered>c){if(!this._awaitingForFilterInformed){this.log.INFO("filters found indicating for tag to wait for applicable conditions - waiting...");this._awaitingForFilterInformed=(new Date).valueOf();try{this.onFiltersDelayed()}catch(e){this.log.ERROR("error running onFiltersDelayed:"+
e)}}this._setTimeout(this.runIfFiltersPass.bind(this),a)}else this._markFiltersFailed(),this._markFinished(),this.filtersRunTimedOut=(new Date).valueOf(),this.log.WARN("awaiting for filters timed out.")}try{this.onFiltersCheck(a)}catch(f){this.log.ERROR(f)}return a};a.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date).valueOf()};a.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,LOADING_DEPENDENCIES:16,LOADED_DEPENDENCIES:32,
LOADING_URL:64,LOADED_URL:128,EXECUTED:256,EXECUTED_WITH_ERRORS:512,FAILED_TO_LOAD_DEPENDENCIES:1024,FAILED_TO_LOAD_URL:2048,FAILED_TO_EXECUTE:4096,TIMED_OUT:8192,UNEXPECTED_FAIL:16384,CANCELLED:32768};a.prototype.addState=function(b){a.SUPER.prototype.addState.call(this,b);try{a.onStateChange(this)}catch(c){this.log.ERROR(c)}this.stateStack=[];b=this.STATE;var e=this.state,d=this.stateStack;e&b.INITIAL&&d.push("Initial state.");e&b.FILTER_ACTIVE&&d.push("Tag running with filters pass triggered.");
e&b.FILTERS_FAILED&&d.push("Filters failed to pass.");e&b.AWAITING_CALLBACK&&d.push("Awaiting callback to run this tag. Not pooling.");e&b.STARTED&&d.push("Tag is initialized and loading has been started.");e&b.LOADING_DEPENDENCIES&&d.push("Dependencies are being loaded.");e&b.LOADED_DEPENDENCIES&&d.push("Dependencies loading process has been finished.");e&b.LOADING_URL&&d.push("External URL is being loaded.");e&b.LOADED_URL&&d.push("External URL has been loaded.");e&b.EXECUTED&&d.push("Main script has been executed.");
e&b.EXECUTED_WITH_ERRORS&&d.push("Main script has been executed but errors occured.");e&b.FAILED_TO_LOAD_DEPENDENCIES&&d.push("Dependencies has failed to load.");e&b.FAILED_TO_LOAD_URL&&d.push("URL location failed to load.");e&b.FAILED_TO_EXECUTE&&d.push("Script failed to execute.");e&b.TIMED_OUT&&d.push("Script timed out awaiting for dependencies.");e&b.UNEXPECTED_FAIL&&d.push("Script occured UNEXPECTED exception and is failed.");e&b.CANCELLED&&d.push("Tag has been cancelled.")};a.prototype.onTagInit=
x;a.onStateChange=x;a.prototype.onFiltersDelayed=x;a.prototype.onFiltersPassed=x;a.prototype.onFiltersCheck=x;a.prototype.state=a.prototype.STATE.INITIAL;a.prototype.arePageVariablesLoaded=function(a){return e.allParameterVariablesReadyForTag(this,a)};a.prototype.getDependenciesToBeLoaded=function(b,c){var e=c||[];this.arePageVariablesLoaded(b)||e.push("page variables");return a.SUPER.prototype.getDependenciesToBeLoaded.call(this,b,e)};a.prototype.resolveAllDynamicData=function(){this.resolvePageVariables();
this.resolveDependencies();this.resolveFilters()};a.prototype.resolveDependencies=function(){var a=this.failedDependenciesToParse;a&&(this.failedDependenciesToParse=null,this.addDependenciesList(a,n.clientSpaceClasspath()));return this.dependencies};a.prototype.addClientVariablesMap=function(a){return this.unresolvedClientVariablesMap=this._addVariablesMap(a,n.clientSpaceClasspath())};a.prototype.resolvePageVariables=function(){var a=this.unresolvedClientVariablesMap;a&&(this.unresolvedClientVariablesMap=
null,this.addClientVariablesMap(a));if(a=this.unresolvedVariablesMap)this.unresolvedVariablesMap=null,this.addVariablesMap(a);return this.getPageVariables()};a.prototype.addVariablesMap=function(a){return this.unresolvedVariablesMap=this._addVariablesMap(a)};a.prototype._addVariablesMap=function(a,b){if(a){var c={},e=this.namedVariables,d;for(d in a)if(a.hasOwnProperty(d)){var f=a[d];if(f instanceof l)e[d]=f;else if("string"===typeof f){var n=f;b&&(f=b+"."+f);var m=g.getObjectUsingPath(f);m?e[d]=
m instanceof l?m:f:c[d]=n}else this.log.ERROR("Added variable is of wrong type!"),this.log.ERROR(f)}return c}};a.prototype.prepareURL=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareLocationObject=function(a){return this.replaceTokensWithValues(a)};a.prototype.prepareHTML=function(a){a&&(a=this.replaceTokensWithValues(a));return a};a.prototype._executeScript=function(){if(this.config&&this.config.script)if("function"===typeof this.config.script)this.script=this.config.script;
else{var b=this.replaceTokensWithValues(String(this.config.script));this.script=g.expressionToFunction(b).bind(this)}a.SUPER.prototype._executeScript.call(this)};a.prototype.replaceTokensWithValues=function(a){if(!a||-1===a.indexOf("${"))return a;var b=this.parameters;if(b)for(var c=0;c<b.length;c++){var e=this.getVariableForParameter(b[c]);if(e){var d=b[c].token,f=this.valueForToken(d);a=e.replaceToken(d,a,f)}}return a};a.prototype.getParameter=function(a){var b=this.parameters,c=null;if(b)for(var e=
0;e<b.length;e++)b[e].name===a&&(c=b[e]);return c};a.prototype.setParameterValueByTokenName=function(a,b){var c=this.getParameterByTokenName(a);return null!==c?(c.variable={value:b},!0):!1};a.prototype.getParameterValue=function(a,b){var c="string"===typeof a?this.getParameter(a):a;if(c){var e=this.getVariableForParameter(c);if(e)try{var d;b&&""!==c.defaultValue&&(d=g.gevalAndReturn(c.defaultValue).result);return d=e.getRelativeValue(b,d)}catch(f){this.log.ERROR("error while trying to resolve variable value:"+
f),this.log.ERROR("Variable defaults string is invalid: "+c.defaultValue)}}};a.prototype.filtersState=function(a){return c.filtersState(this.filters,this.session,this,a)};a.prototype.addFilter=function(a){g.addToArrayIfNotExist(this.filters,a)};a.prototype.addFilters=function(a){for(var b=0;b<a.length;b++)this.addFilter(a[b])};a.prototype.addClientFiltersList=function(a){return this.unresolvedClientFilterClasspaths=this.addFiltersList(a,n.clientSpaceClasspath())};a.prototype.resolveFilters=function(){var a=
this.unresolvedClientFilterClasspaths;a&&(this.unresolvedClientFilterClasspaths=null,this.addClientFiltersList(a));return this.filters};a.prototype.addFiltersList=function(a,b){for(var c=[],e=0;e<a.length;e++)try{var f=a[e],l=f,n=null;"string"===typeof f&&(n=f,b&&(f=b+"."+f),f=g.getObjectUsingPath(f));"function"===typeof f&&(f=new f);f||this.log.FINE("Filter "+l+" does NOT exists.");!f instanceof d&&(this.log.ERROR("Not a filter! ",f),f=null);f?this.addFilter(f):n&&g.addToArrayIfNotExist(c,n)}catch(m){this.log.FINE("Failed adding filter: "+
a[e]),this.failedFilters=this.failedFilters||[],this.failedFilters.push(a[e])}return c};a.prototype.reset=function(){a.SUPER.prototype.reset.call(this);this.dedupePingSent=this.filtersPassed=void 0;this.pingSent=!1;this._runner=this.filtersRunTriggered=this._runOnceIfFiltersPassTriggered=void 0;this.reRunCounter=0;this.detachVariablesChangedListeners()};a.prototype.resetFilters=function(){for(var a=0;a<this.filters.length;a++)this.filters[a].reset()};a.prototype.getParameterByTokenName=function(a){var b=
null;if(this.parameters)for(var c=this.parameters,e=0;e<c.length;e++)c[e].token===a&&(b=c[e]);return b};a.prototype.removeFilter=function(a){g.removeFromArray(this.filters,a)};var q=0,w=[],p={},u={};a.register=function(a){r.FINEST('registering tag named "'+a.config.name+'", instance of:');r.FINEST(a,!0);var b=g.addToArrayIfNotExist(w,a);-1!==b&&r.FINE("tag already exists in tags registry.");a._tagIndex=-1===b?w.length-1:b;a.config.id?(b="Q"+a.config.id,u[b]=a,a.uniqueId=b):u[a.CLASSPATH]=a};a.getById=
function(a){return u[String(a)]};a.prototype.getById=a.getById;a.prototype.unregister=function(b){a.unregister(b||this)};a.prototype.destroy=function(){this.destroyed=!0;this.cancel();a.unregister(this)};a.unregister=function(a){r.FINEST('Un-registering tag named "'+a.config.name+'", instance of:');r.FINEST(a,!0);var b=g.removeFromArray(w,a);b&&0!==b.length||r.FINEST("tag "+a.config.name+" is already unregistered.");a._tagIndex=-1};a.getTags=function(){return w};a.getAccessorsMap=function(){return p};
a.prototype.getTags=function(){return w};a.prototype.getPageVariables=function(){var a=this.parameters,b=[];if(a)for(var c=0;c<a.length;c++){var e=this.getVariableForParameter(a[c]);this._isVariable(e)&&g.addToArrayIfNotExist(b,e)}if(this.namedVariables)for(var d in this.namedVariables)g.addToArrayIfNotExist(b,m(this,d));return b};a.prototype.getAccessorString=function(){this._accessorsMapKey||(this._accessorsMapKey="_"+q++,p[this._accessorsMapKey]=this);return"qubit.opentag.BaseTag.getAccessorsMap()."+
this._accessorsMapKey};a.prototype.getVariableForParameter=function(a){var b,c=this.namedVariables;c&&c[a.token]&&(b=m(this,a.token));b||(b=e.validateAndGetVariableForParameter(a));return b};a.prototype.printVariablesState=function(){var a=[];this.log.FINE("Tag has been timed out, showing variables:");for(var b=e.getAllVariablesWithParameters(this),c=0;c<b.length;c++){var d=b[c].parameter,f=b[c].variable,l;l=d&&d.token?this.valueForToken(d.token):f.getRelativeValue(!0);f={name:f.config.name,exists:f.exists(),
token:d?d.token:null,value:l,variable:f};a.push(f);this.log.FINE(" Variable Name: "+f.name+", Exists: "+f.exists+", Token: "+(d?d.token:"<param is not assigned>")+", Value:"+l)}return a};a.prototype._triggerOnLoadTimeout=function(){this.printVariablesState();this.onLoadTimeout()};a.prototype.getId=function(){return this._getUniqueId()};a.prototype._getUniqueId=function(){return this.config.id?this.config.id:0===String(this.CLASSPATH).indexOf(n.STANDARD_CS_NS)?this.CLASSPATH.substring(n.STANDARD_CS_NS.length+
1):this.CLASSPATH+"#"+this.config.name};a.prototype.cookieSaysToRunEvenIfDisabled=function(){var a=this._getUniqueId(),b=!!f.get("qubit.tag.forceAllToRun");b||(b=!!f.get("qubit.tag.forceRunning_"+a));return b};a.prototype.setCookieForcingTagToRun=function(){var a=this._getUniqueId();f.set("qubit.tag.forceRunning_"+a,"true")};a.setCookieForcingTagsToRun=function(){f.set("qubit.tag.forceAllToRun","true")};a.prototype.setCookieToDisable=function(){var a=this._getUniqueId();f.set("qubit.tag.disableRunning_"+
a,"true")};a.prototype.rmCookieToDisable=function(){var a=this._getUniqueId();f.rm("qubit.tag.disableRunning_"+a)};a.prototype.disabledByCookie=function(){var a=this._getUniqueId();return!!f.get("qubit.tag.disableRunning_"+a)};a.rmCookieForcingTagsToRun=function(){f.rm("qubit.tag.forceAllToRun")};a.prototype.rmCookieForcingTagToRun=function(){var a=this._getUniqueId();f.rm("qubit.tag.forceRunning_"+a)};a.rmAllDisablingCookies=function(){g.rmCookiesMatching("qubit.tag.disableRunning_")};a.rmAllCookiesForcingTagToRun=
function(){g.rmCookiesMatching("qubit.tag.forceRunning_");a.rmCookieForcingTagsToRun()};a.prototype.onVariableChanged=function(a){this.attachVariablesChangedListeners(!0);this.events.on("variableChanged",a)};a.prototype._handleVariableChange=function(a){this.log.FINEST("Variable "+a.variable.CLASSPATH+" changed from : "+a.oldValue+"to:"+a.newValue);this.events.call("variableChanged",a);this.isRunning||!this.config.reRunOnVariableChange||!isNaN(this.config.reRunLimit)&&this.config.reRunLimit<=this.reRunCounter||
(a=this.reRunCounter+1,this.reset(),this.reRunCounter=a,this.resetFilters(),this.runIfFiltersPass())};a.prototype.attachVariablesChangedListeners=function(a){var b=this.getPageVariables();if(a=!!(this.config.reRunOnVariableChange||this.config.observeVariables||a))for(var c=0;c<b.length;c++)b[c].onValueChanged(this.handleVariableChange,a)};a.prototype.detachVariablesChangedListeners=function(){for(var a=this.getPageVariables(),b=0;b<a.length;b++)a[b].deatchOnValueChanged(this.handleVariableChange)};
a.prototype._markFinished=function(){this.log.FINE("Marked finished.");a.SUPER.prototype._markFinished.call(this);this.attachVariablesChangedListeners()}})();(function(){var a=new h.opentag.Log("Tags -> "),m=h.opentag.Utils,g=h.opentag.filter.BaseFilter,c=function(){};h.Define.clazz("qubit.opentag.Tags",c);c.getById=function(a){return h.opentag.BaseTag.getById(String(a))};c.getAllTagsByState=function(){return h.opentag.Container.getAllTagsByState(c.getTags())};c.findTagByName=function(a){for(var c=
this.getTags(),d=[],f=0;f<c.length;f++)c[f].config.name===a&&d.push(c[f]);return d};c.findTagByMatch=function(a){for(var c=this.getTags(),d=[],f=0;f<c.length;f++)c[f].config.name.match(a)&&d.push(c[f]);return d};c.findTagContainers=function(a){for(var e=c.getContainers(),d=[],f=0;f<e.length;f++){var n=e[f].tags,g;for(g in n)if(n[g]===a){d.push(e[f]);break}}return d};c.getTags=function(){a.FINEST("getTags");return h.opentag.BaseTag.getTags()};c.resetAllTags=function(b){a.WARN("reseting all tags!");
for(var e=c.getTags(),d=0;d<e.length;d++)e[d].reset(),b||e[d].resetFilters()};c.getContainersPageVariables=function(){for(var a=c.getContainers(),e=[],d=0;d<a.length;d++)e=e.concat(a.getPageVariables());return e};c.getAllPageVariables=function(){for(var a=c.getTags(),e=[],d=0;d<a.length;d++)e=e.concat(a[d].getPageVariables());return e};c.cancelAll=function(){for(var a=c.getTags(),e=0;e<a.length;e++)a[e].cancel()};c.resetAll=function(a){for(var e=c.getTags(),d=0;d<e.length;d++)e[d].reset(),a||e[d].resetFilters()};
c.getPageVariableByName=function(a){for(var e=c.getAllPageVariables(),d=[],f=0;f<e.length;f++)e[f].config.name===a&&d.push(e[f]);return d};c.getLoadTime=function(a){var c=a.beforeRun,d=a.runIsFinished;return isNaN(d)?{tag:a,loadTime:null}:{tag:a,loadTime:d-c}};c.getLoadTimes=function(a){var e=[];if(a instanceof h.opentag.BaseTag)return e.push([c.getLoadTime(a[d])]),e;a=a||c.getTags();if(a instanceof Array)for(d=0;d<a.length;d++)a[d]instanceof h.opentag.BaseTag&&e.push(c.getLoadTime(a[d]));else for(var d in a)a[d]instanceof
h.opentag.BaseTag&&e.push(c.getLoadTime(a[d]));return e};c.forceAllContainersAndTagsToRunIfDisabled=function(){h.opentag.Container.setCookieForDisabledContainersToRun();h.opentag.BaseTag.setCookieForcingTagsToRun()};c.rmAllContainersAndTagsForcingFlags=function(){h.opentag.Container.rmCookieForDisabledContainersToRun();h.opentag.BaseTag.rmAllCookiesForcingTagToRun()};c.getContainers=function(){return h.opentag.Container.getContainers()};c.findAllTagsByClassPath=function(b){var e=(new Date).valueOf(),
d=[],f=[];try{f.push(h.opentag.CustomTag),f.push(h.opentag.LibraryTag)}catch(n){a.FINEST("Warning:Missing known libraries: CustomTag, LibraryTag")}for(var g=c.getTags(),q=0;q<g.length;q++){var w=g[q];0>m.indexInArray(f,w)&&0===w.PACKAGE_NAME.indexOf(b)&&(d.push(w),a.FINEST("findAllTagsByClassPath(): found: "+w.PACKAGE_NAME+" -> "+w.config.name))}a.FINE("findAllTags(): selection found in "+((new Date).valueOf()-e));return d};c.findAllTags=function(b,e){var d=h.opentag.BaseTag,f=[],n=(new Date).valueOf();
try{f.push(h.opentag.CustomTag),f.push(h.opentag.LibraryTag)}catch(g){a.FINEST("Warning:Missing known libraries: CustomTag, LibraryTag")}d=c.findAllInstances(b,d,f,e);a.FINE("findAllTags(): found in "+((new Date).valueOf()-n));return d};var d=function(b,c,d,f){var n=[];"string"===typeof b&&(b=m.getObjectUsingPath(b));if(b){var g={objectsOnly:!0};f&&(g.maxDeep=!0);g.track=!0;f=(new Date).valueOf();var h=function(b,f,g,k){if(c(b)){for(f=0;f<d.length;f++)if(d[f]===b)return!0;a.FINE("found ["+k+"]:"+
(b.config?b.config.name:g));m.addToArrayIfNotExist(n,b);return!0}return!1}.bind(this);m.traverse(b,h,g);a.FINE("Found in "+((new Date).valueOf()-f))}return n};c.findAllInstances=function(a,c,g,f){return d(a,function(a){return a instanceof c},g,f)};c.findAllInheriting=function(a,c,g,f){return d(a,function(a){return a.prototype instanceof c},g,f)};c.findAllFilters=function(b,e){var d=[];try{d.push(h.opentag.filter.Filter),d.push(h.opentag.filter.URLFilter)}catch(f){a.FINE("Warning: Missing known libraries: CustomTag, LibraryTag")}return c.findAllInheriting(b,
g,d,e)};a.INFO("*** Qubit TagSDK *** ",!0,"font-size: 22px; color:#CCC;text-shadow:#fff 0px 1px 0, #555 0 -1px 0;")})();E={};B=void 0;E.update=function(){var a,m;m=function(){return Math.floor(1+65536*Math.random()).toString(36).substring(1)};window.__pageViewId__||(a=(new Date).getTime().toString(36),window.__pageViewId__=a+m()+m()+m());return window.__pageViewId__};s.PostData=function(a,m,g){var c,d,b,e,l,f,n;n=2;l=!1;f=function(){0<n&&setTimeout(function(){l||(n-=1,c())},5E3)};d=navigator.userAgent.toLowerCase();
b=-1!==d.indexOf("msie");d.indexOf("msie 9");d=-1!==d.indexOf("msie 7")||-1!==d.indexOf("msie 6");e=("https:"===document.location.protocol?"https:":"http:")+a;g=g||"POST";c=function(){var a;try{a=null;try{a=new XMLHttpRequest}catch(c){}a&&!b?a.open(g,e,!0):"undefined"!==typeof XDomainRequest?(a=new XDomainRequest,a.open(g,e)):a=null;try{a.withCredentials=!1}catch(d){}a.setRequestHeader&&a.setRequestHeader("Content-Type","text/plain;charset=UTF-8");a.onload=function(){l=!0};a.onreadystatechange=function(){};
a.ontimeout=function(){};a.onerror=function(){};a.onprogress=function(){};a.send(m)}catch(n){try{try{s.fileLoader.load(e)}catch(h){window.console&&window.console.log&&window.console.log(n)}}catch(k){}}f()};d?s.fileLoader.load(e):c()};(function(){function a(){}var m=new h.opentag.Log("Ping -> ");h.Define.clazz("qubit.opentag.Ping",a);a.prototype.send=function(g,c){for(var d=g.config,b="c="+d.clientId+"&p="+g.getContainerId()+"&l="+d.tellLoadTimesProbability+"&pv="+E.update()+"&d=",e=[],l=0;l<c.length;l++){var f=
c[l].tag,n=c[l].loadTime;if(null!==n&&!isNaN(n)){var h=a.getPingID(f);!f.pingSent&&h&&null!==n?void 0!==h?(e.push('"'+h+'":'+n),f.pingSent=!0):m.WARN("send: tag `"+f.config.name+"` has no ID assigned! Time load will not be sent."):f.pingSent?m.FINEST("send: ping already sent for `"+f.config.name+"`, ignoring."):null===n&&m.FINEST("send: null load times for `"+f.config.name+"`, ignoring (ping not sent).")}}d.pingServerUrl&&0<e.length?(b+=encodeURIComponent("{"+e.join(",")+"}"),d="//"+d.pingServerUrl+
"/tag2?"+b,m.FINE("send: sending pings "+d),s.PostData(d,null,"GET")):(e.length||m.FINE("send: no pings to sent"),d.pingServerUrl||m.WARN("send: config.pingServerUrl is unset!"))};a.prototype.sendErrors=function(a,c){m.WARN("Errors sending is disabled.")};a.prototype.sendDedupe=function(g,c){for(var d=g.config,b="c="+d.clientId+"&p="+g.getContainerId()+"&l="+d.tellLoadTimesProbability+"&pv="+E.update()+"&dd=",e=[],l=0;l<c.length;l++){var f=c[l],n=a.getPingID(f);void 0===n?m.WARN("sendDedupe: tag `"+
f.config.name+"` has no ID assigned! Deduplicaton time load will not be sent."):f.dedupePingSent||(e.push(n),f.dedupePingSent=!0)}0<e.length&&d.pingServerUrl?(b+=encodeURIComponent("["+e.join(",")+"]"),s.PostData("//"+d.pingServerUrl+"/tag2?"+b,null,"GET")):(e.length||m.FINE("sendDedupe: no dedupe pings to sent"),d.pingServerUrl||m.WARN("sendDedupe: config.pingServerUrl is unset!"))};a.getPingID=function(a){if(a.config.id)return a.config.id;var c=a.PACKAGE_NAME.lastIndexOf(".");return-1!==c?a.PACKAGE_NAME.substring(c+
1):a.PACKAGE_NAME}})();B={_cookieName:"_qst_s",_sessionCookie:"_qsst_s",update:function(a){var m,g;m=h.Cookie.get(B._cookieName);g=h.Cookie.get(B._sessionCookie);if(m){if(m=parseInt(m,10),!g||parseInt(g,10)<(new Date).getTime()-18E5)m+=1}else m=1;h.Cookie.set(B._cookieName,m,365,a);h.Cookie.set(B._sessionCookie,(new Date).getTime().toString(),null,a);return m}};var z={};(function(){function a(a){return 10>a?"0"+a:a}function m(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=l[a];
return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function g(c,d){var l,h,p,u,k=b,v,t=d[c];if(t instanceof Date)l=t,t=isFinite(l.valueOf())?l.getUTCFullYear()+"-"+a(l.getUTCMonth()+1)+"-"+a(l.getUTCDate())+"T"+a(l.getUTCHours())+":"+a(l.getUTCMinutes())+":"+a(l.getUTCSeconds())+"Z":null;else if(t instanceof String||t instanceof Number||t instanceof Boolean)t=t.valueOf();"function"===typeof f&&(t=f.call(d,c,t));switch(typeof t){case "string":return m(t);
case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);case "object":if(!t)return"null";b+=e;v=[];if("[object Array]"===Object.prototype.toString.apply(t)){u=t.length;for(l=0;l<u;l+=1)try{v[l]=g(l,t)||"null"}catch(A){v[l]='{"stack_exceeded": null}'}p=0===v.length?"[]":b?"[\n"+b+v.join(",\n"+b)+"\n"+k+"]":"["+v.join(",")+"]";b=k;return p}if(f&&"object"===typeof f)for(u=f.length,l=0;l<u;l+=1){if("string"===typeof f[l]){h=f[l];try{p=g(h,t)}catch(P){p='{"stack_exceeded": null}'}p&&
v.push(m(h)+(b?": ":":")+p)}}else for(h in t)if(Object.prototype.hasOwnProperty.call(t,h)){try{p=g(h,t)}catch(s){p='{"stack_exceeded": null}'}p&&v.push(m(h)+(b?": ":":")+p)}p=0===v.length?"{}":b?"{\n"+b+v.join(",\n"+b)+"\n"+k+"}":"{"+v.join(",")+"}";b=k;return p}}var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b,e,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},f;"function"!==typeof z.stringify&&(z.stringify=function(a,c,d){var l;e=b="";if("number"===typeof d)for(l=0;l<d;l+=1)e+=" ";else"string"===typeof d&&(e=d);if((f=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return g("",{"":a})});"function"!==typeof z.parse&&(z.parse=function(a,b){function e(a,c){var k,d,f=a[c];if(f&&"object"===typeof f)for(k in f)Object.prototype.hasOwnProperty.call(f,
k)&&(d=e(f,k),void 0!==d?f[k]=d:delete f[k]);return b.call(a,c,f)}var d;a=String(a);c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof b?e({"":d},""):d;throw new SyntaxError("JSON.parse");})})();(function(){function a(a){if(a)if(a.alphabet)for(this.alphabet=
a.alphabet,this.dict={},a=0;a<this.alphabet.length;a++)this.dict[this.alphabet[a]]=a;else this.alphabet=g,this.dict=b}function m(a,b){for(var c in b)if(a===b[c])return c;return null}for(var g=[],c=Math.pow(2,8),d=0;d<c;d++)g.push(String.fromCharCode(d));for(var b={},c=0;c<g.length;c++)b[g[c]]=c;h.Define.clazz("qubit.compression.LZW",a);a.prototype.encode=function(a){for(var b=this.alphabet.length,c={},d=[],g=0,m=a.charAt(g++),h,p=this.dict;h=a.charAt(g++);){var u=m+h;if(p.hasOwnProperty(u)||c.hasOwnProperty(u))m=
u;else{var k=p.hasOwnProperty(m)?p[m]:c[m];if(void 0===k)throw"Dictionary base is to small for those contents: "+m;d.push(k);c[u]=b++;m=h}}""!==m&&d.push(c.hasOwnProperty(m)?c[m]:p[m]);return d};a.prototype.decode=function(a){for(var b=this.dict,c=this.alphabet.length,d,g={},h=m(a[0],b),w=h,p=[h],u=1;u<a.length;u++){var k=a[u];d=m(k,b);null===d&&(g.hasOwnProperty(k)&&(d=g[k]),null===d&&(d=w+h));p.push(d);h=d.charAt(0);g[c++]=w+h;w=d}return p.join("")}})();(function(){function a(a){}for(var m={},g=
0;45>g;g++)m["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(g)]=g;for(var c={},g=0;45>g;g++)c['ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-+()@{|}"]^_`~$&#'.charAt(g)]=g;for(var d={},g=0;45>g;g++)d["abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(g)]='ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-+()@{|}"]^_`~$&#'.charAt(g);var b="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".split(""),e=b.length,l=new h.compression.LZW({});h.Define.clazz("qubit.compression.Compressor",a);a.prototype.compress=function(a,b){for(var c=
(b||l).encode(a),d=[],e=0;e<c.length;e++)d.push(String.fromCharCode(c[e]));return d.join("")};a.prototype.compressAnsi=function(a,c){for(var g=(c||l).encode(a),m=[],h=0;h<g.length;h++){var p;p=g[h];var u=0,k=0>p;k&&(p=-p);var v="",t=!0;do u=p%e,t?(v=d[b[u]],t=!1):v=b[u]+v,p=(p-u)/e;while(0<p);p=k?"-"+v:v;m.push(p)}return m.join("")};a.prototype.decompressAnsi=function(a,b){for(var d=[],g="",h=0;h<a.length;h++){var p=a.charAt(h);if(c.hasOwnProperty(p)){for(var p=g+p,g="",u=0,k=0,v=!0,t=0;t<p.length;t++){var A=
p.charAt(p.length-1-t);v&&(v=!1,A="abcdefghijklmnopqrstuvwxyz0123456789'%./:<>?[".charAt(c[A]));u+=m[A]*Math.pow(e,k++)}p=u;d.push(p)}else g+=p}return(b||l).decode(d)};a.prototype.decompress=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(a.charCodeAt(d));return(b||l).decode(c)}})();(function(){function a(a){for(var b=[],c=0;c<a.length;c++){var e=d(a[c][0]);b.push([new RegExp(e,"g"),"*"+a[c][1]])}return b}function m(a,b){for(var c=0;c<b.length;c++)if(b[c][1]===a)return b[c][0];return null}function g(b){this._regexDefs=
n;this._defs=f;b&&b.definitions&&(this._regexDefs=a(b.definitions),this._defs=b.definitions)}function c(a,b){for(var c=[],d=0;d<a.length;d++){var e=!0;b&&(e=a.charCodeAt(d)<=b);var f=l.cookieAlphabetMap.hasOwnProperty(a.charAt(d));e&&!f?c.push("*"+a.charCodeAt(d)+"."):c.push(a.charAt(d))}return c.join("")}function d(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function b(a){for(var b={},c="",d=0;d<a.length;d++){var e=a.charAt(d);r[e]?c+=e:(isNaN(b[c])&&(b[c]=a.split(c).length-1),c="")}a=
[];for(var f in b)b.hasOwnProperty(f)&&(c=b[f],c>=s&&f.length>=q&&a.push([f,c]));return a=a.sort(function(a,b){return a[0].length===b[0].length?0:b[0].length>a[0].length?1:-1})}var e=h.Define,l=h.Cookie,f=[['","referrer":[{"url":"http://',"1-"],['","referrer":[{"url":"https://',"2-"],[',"referrer":[{"url":"http://',"3-"],[',"referrer":[{"url":"https://',"4-"],[',"sessionStartTime":',"5-"],["www.google.co.uk","6-"],["www.google.","7-"],['"sessionStartTime":',"8-"],['"landing":"',"9-"],["http%3A%2F%2Fwww",
"10-"],['"landing":',"L"],['"time":',"A"],['"pageViews":',"P"],['"sessionCount":',"B"],['"referrer":',"R"],['"url":"http://www.',"J"],['"url":"https://www.',"M"],['"url":"',"I"],['"url":',"U"],["http://www.","W"],["https://www.","V"],["%2Fen%2Ftsuk%2F","K"],['"sessionLandingPage":',"F"],["http%3A%2F%2F","D"],["http://","H"],["https://","X"],['""',"O"],['",',"Y"],['":{}}',"z"],["<","S"],[">","G"],["[","Z"],["]","E"],["{","a"],["}","b"],["(","c"],[")","d"],["!","e"],["#","f"],["$","g"],["!","q"],["'",
"i"],[":","j"],["?","k"],["^","x"],["`","m"],["|","n"],["~","o"],["%","v"],[",","C"]],n=a(f);e.clazz("qubit.opentag.compression.Encoder",g);g.prototype.encode=function(a,e){for(var k=a.replace(/\*/g,"**"),f=b(k),g=0;g<this._regexDefs.length;g++)var l=this._regexDefs[g],k=k.replace(l[0],l[1]);k=k.replace(/;/g,"*-");k=k.replace(/&/g,"*.");k=k.replace(/\\/g,"*/");k=k.replace(/=/g,"*+");k=k.replace(/\n/g,"*N");k=k.replace(/ /g,"*_");k=k.replace(/\t/g,"*T");k=k.replace(/"/g,"*Q");g=b(k);g.concat(f);for(var f=
k.replace(/@/g,"@@"),l=[],m=0,n=0;m<g.length;m++){var h=new RegExp(d(g[m][0]),"g"),h=f.replace(h,"@"+n+"-");h!==f&&(l.push(g[m][0]),n++,f=h)}g=[f,l];f=g[1];(l=0<f.length)&&(k=g[0]);k=e?c(k,e):c(k);return l?"Y"+f.join("*")+"@"+k:"N"+k};for(var r={},e=0;65>e;e++)r["abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ+_.".charAt(e)]=!0;var q=4,s=2;g.prototype.decode=function(a){var b=null;if("N"===a.charAt(0))a=a.substring(1);else if("Y"===a.charAt(0)){var c=a.indexOf("@");if(0<=c&&(b=a.substring(1,
c),b=b.split("*"),a=a.substring(c+1),b&&0!==b.length&&a)){for(var c="",d=!1,e=!1,f="",g=0;g<a.length;g++){var l=a.charAt(g);"@"===l||d||e?d||e?(d=!1,"@"===l?c+="@":isNaN(+("-"+l))?e?(c=b&&"-"===l&&b[+f]?c+b[+f]:c+("@"+f+l),f="",e=!1):c+="@"+l:(e=!0,f+=l)):d=!0:c+=l}f&&(c+="@"+f);d&&(c+="@");a=c}}b="";d=c=!1;e="";for(f=0;f<a.length;f++)g=a.charAt(f),"*"===g||c||d?c||d?(c=!1,isNaN(+("-"+g))?d?(b="."===g?b+String.fromCharCode(+e):"-"===g&&m(e+"-",this._defs)?b+m(e+"-",this._defs):b+("*"+e+g),e="",d=
!1):"*"===g?b+="*":"-"===g?b+=";":"/"===g?b+="\\":"."===g?b+="&":"+"===g?b+="=":"N"===g?b+="\n":"_"===g?b+=" ":"T"===g?b+="\t":"Q"===g?b+='"':null!==m(g,this._defs)?(g=m(g,this._defs),b+=g):b+="*"+g:(e+=g,d=!0)):c=!0:b+=g;e&&(b+="*"+e);c&&(b+="*");return b}})();(function(){function a(a){this.testBinary=!1;this.binSupported=d;a&&(c.FINEST("Created compressor instance."),this.compressor=new h.compression.Compressor,this.encoder=new h.opentag.compression.Encoder({}))}var m=h.Define,g=h.Cookie,c=new h.opentag.Log("CookieCompressor -> "),
d=!1;m.clazz("qubit.opentag.compression.CookieCompressor",a);a.prototype.compress=function(a,d){if("string"!==typeof a||""===a)return a;c.FINEST("Compressing...");var l=this.encoder.encode(a),f;if(this.binSupported||this.testBinary){f=this.compressor.compress(l);f='"B'+this.encoder.encode(f,128)+'"';g.set("__qtag_test_bin__",f,void 0,void 0,!0);var m=g.get("__qtag_test_bin__",!0);g.rm("__qtag_test_bin__");m&&m!==f&&(f=null,c.FINEST("Binary cookie saving trial failed."))}m=this.encoder.encode(this.compressor.compressAnsi(l));
l=!d&&l.length<=m.length?"E"+l:"C"+m;if(f&&f.length<l.length)return c.FINEST("Binary compression ratio:"+f.length/a.length),f;c.FINEST("Compression ratio: "+l.length/a.length);return l};a.prototype.decompress=function(a){if("string"!==typeof a||""===a)return a;'"'===a.charAt(0)&&(a=a.substring(1,a.length-1));c.FINEST("Decompressing...");var d=a.charAt(0);a=a.substring(1);switch(d){case "E":return this.encoder.decode(a);case "C":return a=this.compressor.decompressAnsi(this.encoder.decode(a)),this.encoder.decode(a);
case "B":return a=this.compressor.decompress(this.encoder.decode(a)),this.encoder.decode(a);default:throw"This code is not supported! Code: "+d;}}})();(function(){var a=h.Cookie,m=h.opentag.Utils,g=new h.opentag.Log("Session -> "),c=function(){};h.Define.clazz("qubit.opentag.Session",c);var d=new h.opentag.compression.CookieCompressor({});c.readCompressedCookie=function(b){b=a.get(b,!0);return d.decompress(b)};c.setupSession=function(b){var e=b.config,l,f,h,r,q;l={};l.sessionCount=B.update(e.cookieDomain);
q="qtag_"+b.getContainerId();var s="x_qtag_"+b.getContainerId();h=a.get(q);b=!!h;null===h&&(h=a.get(s,!0),h=d.decompress(h));if(h)try{h=z.parse(h)}catch(p){h={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}}}else h={sc:0,sessionCount:0,pageViews:0,sessionStartTime:0,referrer:[],sessionLandingPage:"",__v:{}};f=(new Date).getTime();l.sessionCount!==parseInt(h.sc,10)?(h.sessionStartTime=f,h.sc=l.sessionCount,h.sessionCount+=1,h.referrer.push({url:c.getReferrer(),
landing:m.getUrl().substring(0,300),time:f}),h.sessionLandingPage=m.getUrl().substring(0,300)):c.isReferrerDifferent()&&!c.referrerIsSameAsPrevious(h.referrer,f,18E5)&&(h.referrer.push({url:c.getReferrer(),landing:m.getUrl().substring(0,300),time:f}),h.sessionLandingPage=m.getUrl().substring(0,300),h.sessionStartTime=f,h.sessionCount+=1);l.sessionCount=h.sessionCount;l.sessionStartTime=h.sessionStartTime;l.pageStartTime=f;h.pageViews+=1;l.pageViews=h.pageViews;l.sessionLandingPage=h.sessionLandingPage;
l.referrer=h.referrer;5<l.referrer.length&&l.referrer.splice(2,l.referrer.length-5);r=z.stringify(h);for(f=0;d.compress(r).length>e.maxCookieLength&&5>f;)3<=h.referrer.length?h.referrer.splice(2,1):2===h.referrer.length?h.referrer=[h.referrer[0]]:1===h.referrer.length&&(h.referrer=[]),r=z.stringify(h),f+=1;l.referrer=h.referrer;b&&a.rm(q);q=d.compress(r);a.rm(s);0<e.maxCookieLength&&a.set(s,q,365,e.cookieDomain,!0);l.setVariable=function(b,c,f){h.__v[b]=[c,f?f:0];b=d.compress(z.stringify(h));0<e.maxCookieLength?
a.set(s,b,365,e.cookieDomain,!0):a.rm(s)};l.getCookie=function(b,c){var e=a.get(b,!0);if(e&&(c||0===b.indexOf("x_"))){g.FINE("getCookie() : Comressed cookie accessed:\n"+b+"="+e);try{e=d.decompress(e)}catch(f){g.ERROR("Cookie failed to decompress: "+f)}}else null!==e&&(e=a.decode(e));return e};l.getVariable=function(a){var b;if(a=h.__v[a])if(b=a[1],0===b||b>(new Date).getTime())return a[0];return null};l.on=function(a,b,c){b.attachEvent?b.attachEvent("on"+a,c):b.addEventListener&&b.addEventListener(a,
c,!1)};l.getTagCookie=function(){return c.readCompressedCookie(s)};return c.lastSession=l};c.referrerIsSameAsPrevious=function(a,d,g){var f,h;return 0<a.length?(f=c.getReferrer(),h=m.getUrl().substring(0,300),a=a[a.length-1],a.url===f&&a.landing===h&&a.time+g>d):!1};c.isReferrerDifferent=function(){var a,d;d=c.getReferrer();a=d.indexOf("://");if(-1===a)return!0;try{return 0!==d.substring(a+3).indexOf(c.getDomain())?!0:!1}catch(g){return!0}};c.getReferrer=function(){return document.referrer?document.referrer.substring(0,
300):"direct"};c.getDomain=function(){return document.location.host}})();(function(){function a(c){g.setIfUnset(c,a.defaultConfig);if(this.singleton){var b=h.opentag.Utils.getObjectUsingPath(this.PACKAGE_NAME+"."+this.CLASS_NAME,C);if(b.__instance)return b.__instance.log.FINEST("Returning singleton instance."),b.__instance;b.__instance=this}a.SUPER.call(this,c)}function m(a,b){var c=a.toString(),c=c.replace(/\s*function\s*\([\w\s,_\d\$]*\)\s*\{/,""),c=c.substring(0,c.lastIndexOf("}")),c=c.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)/g,
'$1"${$2}"'),c=c.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'\s*\)(\s*\+\s*["'])/g,'"${$1}"$2'),c=c.replace(/(["']\s*\+\s*)\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)/g,'$1"${$2}"'),c=c.replace(/\s*_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"\s*\)(\s*\+\s*["'])/g,'"${$1}"$2'),c=c.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*'([^']*)'(\s*)\)/g,"$1${$2}$3"),c=c.replace(/(\s*)_*\w+\s*\.\s*valueForToken\s*\(\s*"([^"]*)"(\s*)\)/g,"$1${$2}$3"),c=b.replaceTokensWithValues(c);g.geval(c)}
var g=h.opentag.Utils,c=h.Define;h.Define.clazz("qubit.opentag.LibraryTag",a,h.opentag.BaseTag);a.defaultConfig={vendor:null,imageUrl:null,description:"",async:!1,isPrivate:!1,upgradeable:!0,html:"",parameters:[],prePostWindowScope:!1};a.prototype.pre=function(){this.log.FINEST("emtpy pre called")};a.prototype.post=function(){this.log.FINEST("emtpy post called")};a.prototype.before=function(){a.SUPER.prototype.before.call(this);this.log.INFO("Running PRE script execution...");try{var c=this.config;
if(c&&c.pre)if("function"===typeof c.pre)this.pre=c.pre;else{var b=this.replaceTokensWithValues(String(c.pre));this.pre=g.expressionToFunction(b).bind(this)}this.config.prePostWindowScope&&this.pre!==a.prototype.pre&&this.pre.toString?m(this.pre,this):this.pre()}catch(e){return this.log.ERROR(this.config.name+" exception while running pre: "+e),!0}return!1};a.prototype.after=function(c){a.SUPER.prototype.after.call(this,c);this.log.INFO("Running POST script execution...");try{var b=this.config;if(b&&
b.post)if("function"===typeof b.post)this.post=b.post;else{var e=this.replaceTokensWithValues(String(b.post));this.post=g.expressionToFunction(e).bind(this)}this.config.prePostWindowScope&&this.post!==a.prototype.post&&this.post.toString?m(this.post,this):this.post(c)}catch(h){this.log.ERROR(this.config.name+" exception while running post: "+h)}};a.define=function(d,b){d=d.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");d=h.Define.vendorsSpaceClasspath(d);var e={};b.getDefaultConfig&&
(e=b.getDefaultConfig());var l=b.CONSTRUCTOR,f={},m;for(m in b)"config"!==m&&(f[m]=b[m]);f=h.opentag.Utils.defineWrappedClass(d,a,f,y,function(a){a=a||{};a=g.overrideFromLeftToRight(e,a);var b=h.opentag.LibraryTag.call(this,a);l&&l.call(this,a);if(b)return b});m=c.STANDARD_VS_NS+".";0!==d.indexOf(m)&&g.namespace(m+d,f);return f};a.getLibraryByClasspath=function(a){return g.getObjectUsingPath(a,h.Define.getVendorSpace())}})();(function(){function a(){}var m=h.opentag.LibraryTag,g=h.Define;a.library=
function(){return m.define.apply(m,arguments)};a.libraryRef=function(){return m.getLibraryByClasspath.apply(m.getLibraryByClasspath,arguments)};g.namespace("qubit.Quick",a)})();(function(){function a(b){this.runQueue=[];this.log=new h.opentag.Log("",function(){return this.CLASS_NAME+"["+this.config.name+"]"}.bind(this),!0);this.tags={};this.config={cookieDomain:"",maxCookieLength:1E3,gzip:!0,delayDocWrite:!1,clientId:"",name:"",tellLoadTimesProbability:null,pingServerUrl:null,trackSession:null,disabled:!1,
containerId:"",scanTags:!1,noPings:!1};this.ignoreTagsState=!1;if(b){this.setConfig(b);b.name||(this.config.name="Cont-"+q++);a.register(this);this.log.FINE("container registered.");a.NO_PINGS&&(this.config.noPings=!0);this.ping=new h.opentag.Ping(this.config);this._sendPingsTrigger=this.sendPings.bind(this);if(b.init)try{b.init.call(this,b)}catch(c){this.log.ERROR("init call failed:"+c)}var d=this;this._tagLoadedHandler=function(a){d._containerAlreadySentPings&&(d.sendPingsNotTooOften(),a.success&&
a.tag.log.INFO("[Other]SENDING LOAD STATS"))}}return this}function m(a,b,c){a[c]&&(u[c]=u[c]||1,c+="("+u[c]+")",u[c]++);a[c]=b}var g=h.opentag.Utils,c=h.opentag.filter.BaseFilter,d=h.opentag.filter.Filter,b=h.opentag.BaseTag,e=h.opentag.Timed,l=h.opentag.Tags,f=h.opentag.Session,n=h.Cookie,r=new h.opentag.Log("Container -> "),q=1;try{window.opentag_consentGiven=function(){a.consentIsGiven=!0;for(var b=a.getContainers(),c=0;c<b.length;c++)try{b[c].run()}catch(d){r.ERROR("error running consent dependant containers: "+
d)}}.bind(this)}catch(s){r.WARN("opentag_consentGiven could not be set!")}h.Define.clazz("qubit.opentag.Container",a);var p=[];a.register=function(a){g.addToArrayIfNotExist(p,a)};a.prototype.isTellingLoadTimes=function(){var a=this.config.tellLoadTimesProbability;null===a&&(a=0);return a>Math.random()};a.prototype.destroy=function(a){this.destroyed=!0;this.unregister();if(a)for(var c in this.tags)a=this.tags[c],a instanceof b&&(a.destroy(),this.tags[c]=null,delete this.tags[c]);c=this.PACKAGE_NAME.split(".");
c=c[c.length-1];a=g.getParentObject(this.PACKAGE_NAME);a[c]=null;delete a[c]};a.findContainersByName=function(a){for(var b=this.getContainers(),c=[],d=0;d<b.length;d++)b[d].config.name===a&&c.push(b[d]);return c};a.getById=function(a){for(var b=this.getContainers(),c=0;c<b.length;c++)if(b[c].getContainerId()===a)return b[c];return null};a.prototype.unregister=function(b){a.unregister(this,b)};a.unregister=function(a,c){g.addToArrayIfNotExist(p,a);r.FINEST('Un-registering container named "'+a.config.name+
'", instance of:');r.FINEST(a,!0);var d=g.removeFromArray(p,a);if(c)for(var e in this.tags){var f=this.tags[e];f instanceof b&&(f.unregister(),this.tags[e]=null,delete this.tags[e])}d&&0!==d.length||r.FINE("container is already unregisterd.")};a.prototype.hasConsent=function(){return"Accepted"===n.get("qubitconsent")};a.prototype.register=function(b){a.register(b||this)};a.getContainers=function(){return p};a.prototype.getContainers=function(){return a.getContainers()};a.prototype.onTagRegistered=
function(a){};a.prototype.registerTag=function(a){var b=a.config.name;if(this.tags[b])this.log.FINE("Tag with name `"+b+"` already is registered!");else{this.tags[b]=a;a.onAfter(this._tagLoadedHandler);try{this.onTagRegistered(a)}catch(c){this.log.ERROR("onTagRegistered exception: "+c)}}};a.prototype.registerTags=function(a){for(var b=0;b<a.length;b++)this.registerTag(a[b])};a.prototype.setConfig=function(a){this.log.FINEST("Setting configuration:");this.log.FINEST(a,!0);for(var b in a)this.config[b]=
a[b]};a.prototype.run=function(){this.log.FINE("starting loading");this.runTags({command:"runOnceIfFiltersPass"})};a.prototype.runWithoutFilters=function(){this.log.FINE("starting loading");this.runTags({command:"run"})};a.prototype.getTagByname=function(a){return this.tags[a]};a.prototype.containerScriptLoadedSynchronously=function(){var a,b,c,d,e;d=document.getElementsByTagName("script");a=0;for(b=d.length;a<b;a+=1)if(c=d[a],(e=c.getAttribute("src"))&&0<e.indexOf(""+this.config.clientId+"-"+this.getContainerId()+
".js"))return null===c.getAttribute("async")&&(!1===c.getAttribute("defer")||""===c.getAttribute("defer")||null===c.getAttribute("defer"));return!0};a.prototype.prepareSessionIfNeeded=function(){var b=this.config.trackSession;if(!0!==b&&!1!==b){var b=this.tags,c;for(c in b)if(b.hasOwnProperty(c)){var e=b[c];e.resolveAllDynamicData();for(var e=e.getFilters(),g=0;g<e.length;g++){var h=e[g];if(h instanceof d&&h.isSession()){this.trackSession=!0;break}}if(this.trackSession)break}}else this.trackSession=
b;a.TRACK_SESSION&&(this.trackSession=!0);this.trackSession&&(this.session=f.setupSession(this));this.session&&(this.log.INFO("Session attached:"),this.log.INFO(this.session,!0))};a.prototype.runTags=function(b,c){if(this.destroyed)throw"Container has been destroyed.";if(c||!a.LOCKED&&!g.global().QUBIT_CONTAINERS_LOCKED){if(this.onBeforeRun)try{this.onBeforeRun()}catch(d){this.log.ERROR("Soft failure [Container.onBeforeRun()]: "+d)}var f=!this.containerScriptLoadedSynchronously(),h="runIfFiltersPass";
b&&b.command&&(h=b.command);this.runningStarted=(new Date).valueOf();this.log.FINE("triggering runningStarted at "+this.runningStarted);var l={};this.config.scanTags&&!this._scanned&&(this.scanForTags(),this._scanned=(new Date).valueOf());this.prepareSessionIfNeeded();for(var m=this.getTagsInOrder(),n=0;n<m.length;n++)try{var q=m[n],p=q.config.name;if(this.includedToRun(q)){var r=q.resolveDependencies();if(0<r.length)for(var s=0;s<r.length;s++){var u=r[s],w=u.config.name;!l[w]&&this.tags[w]&&(l[w]=
u,this._tagRunner(u,h,f))}l[p]||(l[p]=q,this._tagRunner(q,h,f))}}catch(x){this.log.ERROR("Error while preparing tag '"+p+"' to run.\n Error: "+x)}e.setTimeout(function(){this.sendPingsNotTooOften()}.bind(this),1100);this.waitForAllTagsToFinish()}else this.log.INFO("All containers are LOCKED."),this.log.INFO("To run, set Container.LOCKED to false and  set Utils.global().QUBIT_CONTAINERS_LOCKED to false or use force parameter."),this.log.WARN("Container locked - stopping here.")};a.prototype.getTagsInOrder=
function(){var a=[],b;for(b in this.tags){var c=this.tags[b],d=c.config.priority;if(0<+d){for(var e=0,f=0;f<a.length;f++){var g=a[f];if(g)if(g=+g.config.priority,0<g&&g>d)e++;else break}a.splice(e,0,c)}else a.push(c)}return a};a.prototype._tagRunner=function(a,b,c){try{this.includedToRun(a)&&(this.log.FINE("triggering tag named: "+a.config.name),c&&(a.forceAsynchronous=!0),this.config.delayDocWrite&&(a.delayDocWrite=!0),a.session=a.session||this.session,a[b]())}catch(d){this.log.ERROR(" -> tagRunner: Error running tag with name '"+
a.config.name+"'.\n Error: "+d)}};a.prototype.getContainerId=function(){if(this.config.containerId)return this.config.containerId;if(this._pkgName)return this._pkgName;var a=this.PACKAGE_NAME.split(".");return this._pkgName=a=a[a.length-1]};a.prototype.includedToRun=function(c){if(!c)return!1;var d=c.config;if(d.inactive||d.disabled&&!c.cookieSaysToRunEvenIfDisabled()||c.disabledByCookie())return!1;d=a.consentIsGiven||!d.needsConsent||this.hasConsent();c=c.state===b.prototype.STATE.INITIAL;return this.ignoreTagsState||
d&&c};a.prototype.scanForTags=function(a,b){a&&(this.tags={});var c;c=b&&"object"===typeof b?this.findAllTags(b):this.findAllTagsByClassPath();this.registerTags(c);return c};a.prototype.findAllTags=function(a,b){a=a||this.tagsPackageName||this.PACKAGE_NAME;return l.findAllTags(a,b)};a.prototype.findAllTagsByClassPath=function(a){a=a||this.PACKAGE_NAME;return l.findAllTagsByClassPath(a)};a.prototype.findAllFilters=function(a,b){a=a||this.tagsPackageName||this.PACKAGE_NAME;return l.findAllFilters(a,
b)};a.prototype.waitForAllTagsToFinish=function(){if(!this._waitForAllTagsToFinishWaiting){this._lastWaited||(this._lastWaited=(new Date).valueOf());var a=this.log,b=15E3<(new Date).valueOf()-this._lastWaited,c=this.allTagsFinished()||b;if(!this._showFinishedOnce&&c){this._lastWaited=null;b&&this.log.WARN("Waiting too long. Check tags dependencies.");this._showFinishedOnce=!0;this.runningFinished=(new Date).valueOf();b=this.getAllTagsByState();c=null===b.awaiting?0:g.keys(b.awaiting).length;a.INFO("********************************************************",
0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Startup tags have ended their processing.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("Finished in "+(this.runningFinished-this.runningStarted)+"ms.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");var d;b.run?(d=g.keys(b.run).length,a.INFO("Successfully run tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.run,!0)):a.INFO("No successfully run tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");
b.failed?(d=g.keys(b.failed).length,a.INFO("Failed to run["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "+(null===b.failed?"":"color: #DF5500;")),a.INFO(b.failed,!0)):a.INFO("No failed tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.awaiting?(d=g.keys(b.awaiting).length,a.INFO("There is still "+c+" tag(s) ready to be fired by awaiting filters that can run.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO("Filter ready tags["+d+"]:",
0," ;color: #0F7600;font-size: 12px;font-weight:bold; color: #DC9500;"),a.INFO(b.awaiting,!0)):a.INFO("No filter ready tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.consent?(d=g.keys(b.consent).length,a.INFO("Consent awaiting tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.consent,!0)):a.INFO("No consent awaiting tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.locked?(d=g.keys(b.locked).length,a.INFO("Locked ["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),
a.INFO(b.locked,!0)):a.INFO("No locked tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");b.other?(d=g.keys(b.other).length,a.INFO("Other unloaded tags["+d+"]:",0," ;color: #0F7600;font-size: 12px;font-weight:bold; "),a.INFO(b.other,!0)):a.INFO("No unloaded tags.",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");a.INFO("********************************************************",0," ;color: #0F7600;font-size: 12px;font-weight:bold; ");this._containerAlreadySentPings=(new Date).valueOf();
this.sendPingsNotTooOften();if(this.onTagsInitiallyRun)this.onTagsInitiallyRun()}else c?(a.INFO("********************************************************"),a.WARN("All tags seem to finished current jobs."),a.INFO("********************************************************")):(this._waitForAllTagsToFinishWaiting=!0,this._showFinishedOnce=!1,e.setTimeout(function(){this._waitForAllTagsToFinishWaiting=!1;this.waitForAllTagsToFinish()}.bind(this),100))}};a.prototype.onTagsInitiallyRun=x;a.prototype.resetAllTags=
function(a){this.log.WARN("reseting all tags!");for(var b in this.tags)if(this.tags.hasOwnProperty(b)){var c=this.tags[b];c.reset();a||c.resetFilters()}};a.prototype.reset=function(a){this.log.WARN("reseting container!");this._showFinishedOnce=this.runningStarted=this._waitForAllTagsToFinishWaiting=this.runningFinished=void 0;this.resetAllTags(a)};a.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};e.runIfNotScheduled(this._sendPingsTrigger,2E3,this._sndLck)};a.prototype.sendPings=
function(){if(this.config.noPings)this.log.WARN("Pings are cancelled due to configuration.");else{var a;if(this.isTellingLoadTimes()){var b=this.getAllTagsByState(),c;b.run&&(c=l.getLoadTimes(b.run),this.log.INFO("Sending standard load pings"),this.lastPingsSentTime=(new Date).valueOf(),this.ping.send(this,c));c=l.getLoadTimes();var d=[];for(a=0;a<c.length;a++){var e=c[a].tag;e.config.dedupe&&e.sendDedupePing&&d.push(e)}0<d.length&&(this.log.INFO("Sending deduplication pings"),this.lastDedupePingsSentTime=
(new Date).valueOf(),this.ping.sendDedupe(this,d));if(b.other){c=l.getLoadTimes(b.other);d=[];for(a=0;a<c.length;a++)d.push(c[a]);0<d.length&&this.ping.send(this,d)}if(b.awaiting){c=l.getLoadTimes(b.awaiting);b=[];for(a=0;a<c.length;a++)b.push(c[a]);0<b.length&&this.ping.send(this,b)}}}};a.prototype.getAllTagsByState=function(){return a.getAllTagsByState(this.tags)};a.getAllTagsByState=function(a){var d=null,e=null,f=null,g=null,h=null,l=null,n=b.prototype.STATE.EXECUTED_WITH_ERRORS,q;for(q in a){var p=
a[q];if(p instanceof b){var r=p.config.name;0<p.scriptExecuted?(d=d||{},m(d,p,r)):p.locked?(l=l||{},m(l,p,r)):0>p.scriptExecuted||p.state>=n?(g=g||{},m(g,p,r)):p.filtersState()===c.state.SESSION||0<p.filtersState()?(f=f||{},m(f,p,r)):p.config.needsConsent?(h=h||{},m(h,p,r)):(e=e||{},m(e,p,r))}}return{run:d,failed:g,awaiting:f,consent:h,locked:l,other:e}};var u={};a.prototype.allTagsFinished=function(){for(var a in this.tags)if(this.tags.hasOwnProperty(a)){var b=this.tags[a];if(b instanceof h.opentag.BaseTag){var d=
b.filtersState();if(!b.config.disabled){var e=0>b.filtersState()&&!b.locked,f=!(b.finished()||b.config.runner&&!b.isRunning);if(e&&f&&(b=0<+b.awaitingDependencies,d!==c.state.SESSION&&!b))return!1}}}return!0};a.prototype.getPageVariables=function(){var a=[],b;for(b in this.tags)if(this.tags.hasOwnProperty(b))for(var c=this.tags[b].getPageVariables(),d=0;d<c.length;d++)g.addToArrayIfNotExist(a,c[d]);return a};a.getPageVariableByName=function(a){for(var b=this.getAllPageVariables(),c=[],d=0;d<b.length;d++)b[d].config.name===
a&&c.push(b[d]);return c};a.prototype._getCookieNameForDisabling=function(){return"qubit.opentag.disableContainerRunning_"+this.getContainerId()+this.config.name};a.prototype.disabledByCookie=function(){return!!n.get(this._getCookieNameForDisabling())};a.prototype.setCookieToDisable=function(){n.set(this._getCookieNameForDisabling(),"true")};a.prototype.rmCookieToDisable=function(){n.rm(this._getCookieNameForDisabling())};a.rmAllDisablingCookies=function(){g.rmCookiesMatching("qubit.opentag.disableContainerRunning_")};
a.setCookieForDisabledContainersToRun=function(){n.set("qubit.opentag.forceContainerRunning","true")};a.rmCookieForDisabledContainersToRun=function(){n.rm("qubit.opentag.forceContainerRunning")}})();(function(){function a(g){m.setIfUnset(g,{url:null,html:"",locationPlaceHolder:"NOT_END",locationObject:"BODY",async:!0});a.SUPER.call(this,g)}var m=h.opentag.Utils;h.Define.clazz("qubit.opentag.CustomTag",a,h.opentag.LibraryTag)})();(function(){var a={callbacks:{},unfired_events:[],early_callbacks:null,
currentUV:null},h,g="universal_variable";a._isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a._targetChanged=function(c,d,b){if(null===b)return"null"===d?!1:!0;if(void 0===b)return d===b?!1:!0;d=z.parse(d);d=a._getNested(d,c);c=a._getNested(b,c);return!a._jsonIsEqual(d,c)};a._processCallbacks=function(){var c;if(a.early_callbacks&&0<a.early_callbacks.length){for(c=0;c<a.early_callbacks.length;c+=1)a.push(a.early_callbacks[c]);a.early_callbacks=null}};a._keyStringToArr=
function(a){a=a.replace(/^\s+/,"").replace(/\s+$/,"");if(""===a)return[];a=a.replace(/\[(\w+)\]/g,".$1");a=a.replace(/^\./,"");return a.split(".")};a._getNested=function(c,d){for(var b=a._keyStringToArr(d),e;0<b.length;)if(e=b.shift(),c.hasOwnProperty(e))c=c[e];else return;return c};a._jsonIsEqual=function(c,d){"string"!==typeof c&&(c=z.stringify(c,a._stripEvents));"string"!==typeof d&&(d=z.stringify(d,a._stripEvents));return c===d};a._stripEvents=function(a,d){if("events"!==a)return d};a._on=function(c,
d){var b;b=c.split(":");c=b[0];b=b[1];a.callbacks[c]=a.callbacks[c]||[];b?a.callbacks[c].push({keyString:b,func:d}):a.callbacks[c].push({func:d})};a._trigger=function(c,d){var b,e;if(a.callbacks[c])for(b=0;b<a.callbacks[c].length;b+=1)"function"===typeof a.callbacks[c][b].func&&((e=a.callbacks[c][b].keyString)?"change"===c&&a._targetChanged(e,a.currentUV,h)&&a.callbacks[c][b].func(d):a.callbacks[c][b].func(d))};a._eventsPush=function(c){var d,b;h.events[h.events.length]=c;c.time=c.time||(new Date).getTime();
if(a.callbacks.event)for(d=0,b=a.callbacks.event.length,d;d<b;d+=1)a.callbacks.event[d].func(c);c.has_fired=!0};a._getUnfiredEvents=function(){for(var c=0,c=0;c<h.events.length;c+=1)h.events[c].has_fired||(a.unfired_events.push(h.events.splice(c,1)[0]),c-=1)};a._fireEvents=function(){for(;0<a.unfired_events.length;)h.events.push(a.unfired_events.shift())};a._resetEventsPush=function(){h.events=h.events||[];-1!==h.events.push.toString().indexOf("[native code]")&&(h.events.push=a._eventsPush,a._getUnfiredEvents(),
a._fireEvents())};a._checkForChanges=function(){a.callbacks.change&&0<a.callbacks.change.length&&!a._jsonIsEqual(a.currentUV,h)&&(a._trigger("change",h),a.currentUV=z.stringify(h,a._stripEvents))};a._setUVLocation=function(c){g=c;a._initUV()};a._initUV=function(){window[g]=window[g]||{events:[]};h=window[g];h.events||(h.events=[])};a.push=function(c){a._isArray(c)&&("on"===c[0]?a._on(c[1],c[2]):"trigger"===c[0]&&c[1]&&a._trigger(c[1]))};a.init=function(c,d){d&&(g=d);a._initUV();!window.uv_listener||
a._isArray(window.uv_listener)?(a.early_callbacks=window.uv_listener||null,window.uv_listener=a,c||a.start()):d&&window.uv_listener._setUVLocation(g)};a.start=function(){a.currentUV=z.stringify(h,a._stripEvents);setInterval(function(){a._initUV();a._resetEventsPush();a._checkForChanges()},500);a._processCallbacks()};s.UVListener=a})();(function(){function a(){}function m(a,c,d){!d||void 0!==a[c]&&""!==a[c]&&null!==a[c]||(a[c]=d)}var g=new h.opentag.Log("Main -> "),c=h.Cookie,d=h.opentag.Utils;h.opentag.Log.setLevel(h.opentag.Log.LEVEL_NONE);
h.opentag.Log.setCollectLevel(3);h.opentag.Log.setLevel(h.opentag.Log.LEVEL_INFO);h.opentag.Log.setCollectLevel(4);h.opentag.Log.setLevelFromCookie();a.run=function(){var b=!1,d;a:{try{var l=y.TAGSDK_MAIN_DISABLED_FUNCTION;if(l&&l()){d=!0;break a}}catch(f){g.ERROR("Buggy GLOBAL.TAGSDK_MAIN_DISABLED_FUNCTION ?\n "+f)}d=0<=document.location.href.indexOf("opentag_disabled=true")?!0:!1}if(!d){d=!1;d=!0;h.DEBUG_MODE=!0;l=!1;if(c.get("opentag_debug_tool")||0<=document.location.href.indexOf("opentag_debug_tool"))l=
!0;var m;!(m=l)&&(m=!1,c.get("opentag_debug")||0<=document.location.href.indexOf("opentag_debug"))&&(m=!0);!d&&m&&(y.TAGSDK_NS_OVERRIDE=h.DEBUG_MODE?!1:!0,b=!0);h.DEBUG_MODE&&(y.TAGSDK_NS_OVERRIDE=!1);try{s.UVListener.init()}catch(r){}a.runAllContainers(b);!b&&d&&l&&!y.TAGSDK_DEBUG_TOOL_LOADED&&(b=document.createElement("script"),b.src="https://s3-eu-west-1.amazonaws.com/opentag-dev/debug-tool/loader-v3.js",document.getElementsByTagName("head")[0].appendChild(b),y.TAGSDK_DEBUG_TOOL_LOADED=!0)}};a.runAllContainers=
function(b){try{for(var c=h.opentag.Container.getContainers(),l=0;l<c.length;l++){var f=c[l],n=f.config;if(!f.runningStarted&&!f.configuredInMain){n.scanTags=!0;var r=d.getParentObject(f.PACKAGE_NAME).ClientConfig;r&&m(f.config,"clientId",r.id);var q=d.getParentObject(f.PACKAGE_NAME).SystemDefaults;q&&(m(n,"pingServerUrl",q.pingServerUrl),m(n,"tellLoadTimesProbability",q.tellLoadTimesProbability));f.configuredInMain=!0;b?(f.destroy(!0),a.loadDebugVersion(f)):y.QUBIT_OPENTAG_STOP_MAIN_EXECUTION?function(){var a=
h.opentag.RUN_STOPPED_EXECUTON;h.opentag.RUN_STOPPED_EXECUTON=function(){try{a&&a()}finally{f.run()}}}(f):(g.INFO("Running container "+f.CLASSPATH),f.run())}}}catch(s){}};a.loadDebugVersion=function(a){var c=document.createElement("script"),d,f=a.config.scriptURL,g;(g=h.opentag.Utils.getParentObject(a.PACKAGE_NAME).ClientConfig)&&g.clientId?g=g.clientId:(g=a.PACKAGE_NAME.split("."),g=g[g.length-2].substring(1));a=a.getContainerId();f&&(d=f,d.lastIndexOf("-debug.js")!==d.length-9&&(d=d.substring(0,
d.length-3),d+="-debug.js"));c.src=d&&"//d3c3cq33003psk.cloudfront.net/opentag-"+g+"-"+a+"-debug.js"!==d?d:"//s3-eu-west-1.amazonaws.com/opentag/opentag-"+g+"-"+a+"-debug.js";document.getElementsByTagName("head")[0].appendChild(c)};h.Define.namespace("qubit.opentag.Main",a)})();var D=!1;try{"object"===typeof module&&module.exports&&(module.exports=J,D=!0)}catch(Q){}!D&&window&&(window.uv=J());var H={},F=[],K=!1,I=!1,G=h.Define.global(),D={allEventsByType:H,subscribe:function(a,h){if(I)G.uv.on(a,h);
else F.push({on:[a,h]})},getEventHistory:function(a){return this.allEventsByType[a]},publish:function(a,h){I?G.uv.emit(a,h):F.push({emit:[a,h]})},connect:function(){L()}};D.connect();h.Define.namespace("qubit.qprotocol.PubSub",D);(function(){function a(c){a.SUPER.apply(this,arguments)}var m=h.qprotocol.PubSub,g=h.opentag.Utils;h.Define.clazz("qubit.opentag.pagevariable.QProtocolVariable",a,h.opentag.pagevariable.BaseVariable);a.prototype.init=function(){if(this.initialized)return!1;this.initialized=
(new Date).valueOf();this.callHandlersOnRead=!0;if(!this.handlerAttached){var a=this,d=this.getValueAndPath(this.value);this.eventName=d[0];this.objectPath=d[1];this.updateValue();m.subscribe(this.eventName,function(b){a.updateValue(b)});this.handlerAttached=(new Date).valueOf()}};a.prototype.getValueAndPath=function(a){var d=a,b;if(d){var e=a.indexOf(":");-1!==e&&(d=a.substring(0,e),b=a.substring(e+1))}return[d,b]};a.prototype.getValue=function(){this.init();return this.currentValue};a.prototype.getEventsHistory=
function(){return m.getEventHistory(this.eventName)};a.prototype.updateValue=function(a){if(!a){var d=this.getEventsHistory();d&&(a=d.current)}d=this.objectPath;a=a&&d?g.getObjectUsingPath(d,a):a;this._updateCurrentValue(a);return a};a.prototype.startObservingForChanges=function(){};a.prototype.stopObservingForChanges=function(){}})();(function(){function a(h){a.SUPER.apply(this,arguments)}h.Define.clazz("qubit.opentag.pagevariable.UniversalVariable",a,h.opentag.pagevariable.Expression)})()})();
